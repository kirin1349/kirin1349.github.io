(function(t){"use strict";var e=function(){function t(t,e){this.notify=null,this.context=null,this.setNotifyMethod(t),this.setNotifyContext(e)}return t.prototype.getNotifyMethod=function(){return this.notify},t.prototype.setNotifyMethod=function(t){this.notify=t},t.prototype.getNotifyContext=function(){return this.context},t.prototype.setNotifyContext=function(t){this.context=t},t.prototype.notifyObserver=function(t){this.getNotifyMethod().call(this.getNotifyContext(),t)},t.prototype.compareNotifyContext=function(t){return t===this.context},t}();t.Observer=e})(puremvc||(puremvc={})),function(t){"use strict";var e=function(){function e(t){if(this.mediatorMap=null,this.observerMap=null,this.multitonKey=null,e.instanceMap[t])throw Error(e.MULTITON_MSG);e.instanceMap[t]=this,this.multitonKey=t,this.mediatorMap={},this.observerMap={},this.initializeView()}return e.prototype.initializeView=function(){},e.prototype.registerObserver=function(t,e){var i=this.observerMap[t];i?i.push(e):this.observerMap[t]=[e]},e.prototype.removeObserver=function(t,e){for(var i=this.observerMap[t],n=i.length;n--;)if(i[n].compareNotifyContext(e)){i.splice(n,1);break}0==i.length&&delete this.observerMap[t]},e.prototype.notifyObservers=function(t){var e=t.getName(),i=this.observerMap[e];if(i)for(var n=i.slice(0),o=n.length,s=0;s<o;s++)n[s].notifyObserver(t)},e.prototype.registerMediator=function(e){var i=e.getMediatorName();if(!this.mediatorMap[i]){e.initializeNotifier(this.multitonKey),this.mediatorMap[i]=e;var n=e.listNotificationInterests(),o=n.length;if(o>0)for(var s=new t.Observer(e.handleNotification,e),r=0;r<o;r++)this.registerObserver(n[r],s);e.onRegister()}},e.prototype.retrieveMediator=function(t){return this.mediatorMap[t]||null},e.prototype.removeMediator=function(t){var e=this.mediatorMap[t];if(!e)return null;for(var i=e.listNotificationInterests(),n=i.length;n--;)this.removeObserver(i[n],e);return delete this.mediatorMap[t],e.onRemove(),e},e.prototype.hasMediator=function(t){return null!=this.mediatorMap[t]},e.getInstance=function(t){return e.instanceMap[t]||(e.instanceMap[t]=new e(t)),e.instanceMap[t]},e.removeView=function(t){delete e.instanceMap[t]},e.MULTITON_MSG="View instance for this multiton key already constructed!",e.instanceMap={},e}();t.View=e}(puremvc||(puremvc={})),function(t){"use strict";var e=function(){function e(t){if(this.view=null,this.commandMap=null,this.multitonKey=null,e.instanceMap[t])throw Error(e.MULTITON_MSG);e.instanceMap[t]=this,this.multitonKey=t,this.commandMap={},this.initializeController()}return e.prototype.initializeController=function(){this.view=t.View.getInstance(this.multitonKey)},e.prototype.executeCommand=function(t){var e=this.commandMap[t.getName()];if(e){var i=new e;i.initializeNotifier(this.multitonKey),i.execute(t)}},e.prototype.registerCommand=function(e,i){this.commandMap[e]||this.view.registerObserver(e,new t.Observer(this.executeCommand,this)),this.commandMap[e]=i},e.prototype.hasCommand=function(t){return null!=this.commandMap[t]},e.prototype.removeCommand=function(t){this.hasCommand(t)&&(this.view.removeObserver(t,this),delete this.commandMap[t])},e.getInstance=function(t){return e.instanceMap[t]||(e.instanceMap[t]=new e(t)),e.instanceMap[t]},e.removeController=function(t){delete e.instanceMap[t]},e.MULTITON_MSG="Controller instance for this multiton key already constructed!",e.instanceMap={},e}();t.Controller=e}(puremvc||(puremvc={})),function(t){"use strict";var e=function(){function t(e){if(this.proxyMap=null,this.multitonKey=null,t.instanceMap[e])throw Error(t.MULTITON_MSG);t.instanceMap[e]=this,this.multitonKey=e,this.proxyMap={},this.initializeModel()}return t.prototype.initializeModel=function(){},t.prototype.registerProxy=function(t){t.initializeNotifier(this.multitonKey),this.proxyMap[t.getProxyName()]=t,t.onRegister()},t.prototype.removeProxy=function(t){var e=this.proxyMap[t];return e&&(delete this.proxyMap[t],e.onRemove()),e},t.prototype.retrieveProxy=function(t){return this.proxyMap[t]||null},t.prototype.hasProxy=function(t){return null!=this.proxyMap[t]},t.getInstance=function(e){return t.instanceMap[e]||(t.instanceMap[e]=new t(e)),t.instanceMap[e]},t.removeModel=function(e){delete t.instanceMap[e]},t.MULTITON_MSG="Model instance for this multiton key already constructed!",t.instanceMap={},t}();t.Model=e}(puremvc||(puremvc={})),function(t){"use strict";var e=function(){function t(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.name=null,this.body=null,this.type=null,this.name=t,this.body=e,this.type=i}return t.prototype.getName=function(){return this.name},t.prototype.setBody=function(t){this.body=t},t.prototype.getBody=function(){return this.body},t.prototype.setType=function(t){this.type=t},t.prototype.getType=function(){return this.type},t.prototype.toString=function(){var t="Notification Name: "+this.getName();return(t+="\nBody:"+(null==this.getBody()?"null":this.getBody().toString()))+"\nType:"+(null==this.getType()?"null":this.getType())},t}();t.Notification=e}(puremvc||(puremvc={})),function(t){"use strict";var e=function(){function e(t){if(this.model=null,this.view=null,this.controller=null,this.multitonKey=null,e.instanceMap[t])throw Error(e.MULTITON_MSG);this.initializeNotifier(t),e.instanceMap[t]=this,this.initializeFacade()}return e.prototype.initializeFacade=function(){this.initializeModel(),this.initializeController(),this.initializeView()},e.prototype.initializeModel=function(){this.model||(this.model=t.Model.getInstance(this.multitonKey))},e.prototype.initializeController=function(){this.controller||(this.controller=t.Controller.getInstance(this.multitonKey))},e.prototype.initializeView=function(){this.view||(this.view=t.View.getInstance(this.multitonKey))},e.prototype.registerCommand=function(t,e){this.controller.registerCommand(t,e)},e.prototype.removeCommand=function(t){this.controller.removeCommand(t)},e.prototype.hasCommand=function(t){return this.controller.hasCommand(t)},e.prototype.registerProxy=function(t){this.model.registerProxy(t)},e.prototype.retrieveProxy=function(t){return this.model.retrieveProxy(t)},e.prototype.removeProxy=function(t){var e;return this.model&&(e=this.model.removeProxy(t)),e},e.prototype.hasProxy=function(t){return this.model.hasProxy(t)},e.prototype.registerMediator=function(t){this.view&&this.view.registerMediator(t)},e.prototype.retrieveMediator=function(t){return this.view.retrieveMediator(t)},e.prototype.removeMediator=function(t){var e;return this.view&&(e=this.view.removeMediator(t)),e},e.prototype.hasMediator=function(t){return this.view.hasMediator(t)},e.prototype.notifyObservers=function(t){this.view&&this.view.notifyObservers(t)},e.prototype.sendNotification=function(e,i,n){void 0===i&&(i=null),void 0===n&&(n=null),this.notifyObservers(new t.Notification(e,i,n))},e.prototype.initializeNotifier=function(t){this.multitonKey=t},e.getInstance=function(t){return e.instanceMap[t]||(e.instanceMap[t]=new e(t)),e.instanceMap[t]},e.hasCore=function(t){return!!e.instanceMap[t]},e.removeCore=function(i){e.instanceMap[i]&&(t.Model.removeModel(i),t.View.removeView(i),t.Controller.removeController(i),delete e.instanceMap[i])},e.MULTITON_MSG="Facade instance for this multiton key already constructed!",e.instanceMap={},e}();t.Facade=e}(puremvc||(puremvc={})),function(t){"use strict";var e=function(){function e(){this.multitonKey=null}return e.prototype.initializeNotifier=function(t){this.multitonKey=t},e.prototype.sendNotification=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.facade()&&this.facade().sendNotification(t,e,i)},e.prototype.facade=function(){if(null===this.multitonKey)throw Error(e.MULTITON_MSG);return t.Facade.getInstance(this.multitonKey)},e.MULTITON_MSG="multitonKey for this Notifier not yet initialized!",e}();t.Notifier=e}(puremvc||(puremvc={}));var puremvc,miniframe,__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();(function(t){"use strict";var e=function(t){function e(){t.call(this),this.subCommands=null,this.subCommands=new Array,this.initializeMacroCommand()}return __extends(e,t),e.prototype.initializeMacroCommand=function(){},e.prototype.addSubCommand=function(t){this.subCommands.push(t)},e.prototype.execute=function(t){for(var e=this.subCommands.slice(0),i=this.subCommands.length,n=0;n<i;n++){var o=new(0,e[n]);o.initializeNotifier(this.multitonKey),o.execute(t)}this.subCommands.splice(0)},e}(t.Notifier);t.MacroCommand=e})(puremvc||(puremvc={})),function(t){"use strict";var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.execute=function(){},e}(t.Notifier);t.SimpleCommand=e}(puremvc||(puremvc={})),function(t){"use strict";var e=function(t){function e(i,n){void 0===i&&(i=null),void 0===n&&(n=null),t.call(this),this.mediatorName=null,this.viewComponent=null,this.mediatorName=null!=i?i:e.NAME,this.viewComponent=n}return __extends(e,t),e.prototype.getMediatorName=function(){return this.mediatorName},e.prototype.getViewComponent=function(){return this.viewComponent},e.prototype.setViewComponent=function(t){this.viewComponent=t},e.prototype.listNotificationInterests=function(){return new Array},e.prototype.handleNotification=function(){},e.prototype.onRegister=function(){},e.prototype.onRemove=function(){},e.NAME="Mediator",e}(t.Notifier);t.Mediator=e}(puremvc||(puremvc={})),function(t){"use strict";var e=function(t){function e(i,n){void 0===i&&(i=null),void 0===n&&(n=null),t.call(this),this.proxyName=null,this.data=null,this.proxyName=null!=i?i:e.NAME,null!=n&&this.setData(n)}return __extends(e,t),e.prototype.getProxyName=function(){return this.proxyName},e.prototype.setData=function(t){this.data=t},e.prototype.getData=function(){return this.data},e.prototype.onRegister=function(){},e.prototype.onRemove=function(){},e.NAME="Proxy",e}(t.Notifier);t.Proxy=e}(puremvc||(puremvc={})),window.puremvc=puremvc,__extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),function(t){var e=function(){function e(){this.m_configData={},this.m_configSettings=null,this.m_configDataCreator=null,this.m_configProtoCreator=null,e.ms_instance=this}return Object.defineProperty(e,"Instance",{get:function(){return e.ms_instance||new e},enumerable:!1,configurable:!0}),e.prototype.setup=function(t){this.m_configSettings=t,this.m_configSettings.initialize(),this.m_configDataCreator=this.m_configSettings.getDataCreator(),this.m_configProtoCreator=this.m_configSettings.getProtoCreator()},e.prototype.containsDataMap=function(t){return!!this.m_configData[t]},e.prototype.getConfigNameByKey=function(t){return this.m_configSettings?this.m_configSettings.getName(t):""},e.prototype.getConfigKeyByName=function(t){return this.m_configSettings?this.m_configSettings.getKey(t):0},e.prototype.getData=function(t,e){return this.m_configData&&this.m_configData[t]?this.m_configData[t][e]:null},e.prototype.getDataMap=function(t){return this.m_configData?this.m_configData[t]:null},e.prototype.getDataList=function(t,e,i){void 0===i&&(i=!1);var n=this.getDataMap(t);if(!n)return null;var o=[];for(var s in n)i&&0==parseInt(s)||o.push(n[s]);return e&&o.sort(this.compareConfigID),o},e.prototype.addConfig=function(t,e,i,n){var o=n,s=n,r=this.m_configDataCreator,a=this.m_configProtoCreator;o&&s&&r&&a&&(this.m_configData[o]=this.parseConfigDataContent(s,i,r,a))},e.prototype.compareConfigID=function(t,e){return t.getId()-e.getId()},e.prototype.parseConfigDataContent=function(e,i,n,o){if(i){var s=0,r={},a=null;if("string"==typeof i){var m=t.strToBytes(i),c=m.length;a=new Uint8Array(c);for(var h=0;h<c;h++)a[h]=m[h]}else a=cc.sys.platform==cc.sys.DESKTOP_BROWSER&&i instanceof Uint8Array?i:new Uint8Array(i);for(;s<a.byteLength;){var u=(a[s+3]<<24)+(a[s+2]<<16)+(a[s+1]<<8)+a[s+0];s+=4;var l=a.slice(s,s+u),p=o.createConfigProto(e,l),d=n.createConfigData(e,p);r[p.getId()]=d,s+=u}return r}},e.ms_instance=null,e}();t.ConfigSystem=e}(miniframe||(miniframe={})),function(t){(function(t){t[t.PREFAB=0]="PREFAB",t[t.ATLAS=1]="ATLAS",t[t.FONT=2]="FONT",t[t.BINARY=3]="BINARY",t[t.ANIMATION=4]="ANIMATION",t[t.AUDIO=5]="AUDIO",t[t.TEXT=6]="TEXT",t[t.JSON=7]="JSON",t[t.TEXTURE=8]="TEXTURE",t[t.SPINE=9]="SPINE",t[t.SPINE_ATLAS=10]="SPINE_ATLAS",t[t.SCENE=999]="SCENE"})(t.LoadAssetTypeDefine||(t.LoadAssetTypeDefine={}))}(miniframe||(miniframe={})),function(t){var e=function(){function e(){this.m_name="",this.m_ext="",this.m_folder="",this.m_type=0,this.m_md5="",this.m_groups=[],this.m_error=null,this.m_body=null,this.m_state=t.LoadStateDefine.NONE,this.m_errorCount=0,this.m_isSaved=!1}return e.prototype.setFile=function(t,e,i,n,o){this.m_name=t,this.m_ext=e,this.m_folder=i,this.m_type=n,this.m_md5=o},e.prototype.getName=function(){return this.m_name},e.prototype.getExt=function(){return this.m_ext},e.prototype.getFolder=function(){return this.m_folder},e.prototype.getType=function(){return this.m_type},e.prototype.getMD5=function(){return this.m_md5},e.prototype.getGroups=function(){return this.m_groups},e.prototype.addGroup=function(e){t.safePush(this.m_groups,e)},e.prototype.removeGroup=function(e){t.safeRemove(this.m_groups,e)},e.prototype.setState=function(t){this.m_state=t},e.prototype.setIsSaved=function(t){this.m_isSaved=t},e.prototype.getIsSaved=function(){return this.m_isSaved},e.prototype.isComplete=function(){return this.m_state==t.LoadStateDefine.COMPLETE||this.m_state==t.LoadStateDefine.SAVED},e.prototype.isBusy=function(){return this.m_state==t.LoadStateDefine.LOADING},e.prototype.hasBody=function(){return!!this.m_body},e.prototype.setBody=function(t){this.m_body=t},e.prototype.getBody=function(){return this.m_body},e.prototype.hasError=function(){return!!this.m_error},e.prototype.setError=function(t){this.m_error=t},e.prototype.increaseCount=function(){this.m_errorCount++},e.prototype.getErrorCount=function(){return this.m_errorCount},e.prototype.reset=function(){this.m_state=t.LoadStateDefine.NONE,this.m_error=null,this.m_body=null},e.prototype.clear=function(){this.m_name="",this.m_ext="",this.m_folder="",this.m_type=0,this.m_groups.length>0&&this.m_groups.splice(0,this.m_groups.length),this.m_error=null,this.m_body=null,this.m_state=t.LoadStateDefine.NONE,this.m_errorCount=0,this.m_isSaved=!1},e}();t.LoadAsset=e}(miniframe||(miniframe={})),function(t){var e=function(){function t(){this.m_id=0,this.m_name="",this.m_list=[],this.m_loadIndex=0,this.m_current=[]}return t.prototype.setID=function(t){this.m_id=t},t.prototype.getID=function(){return this.m_id},t.prototype.setName=function(t){this.m_name=t},t.prototype.getName=function(){return this.m_name},t.prototype.hasAsset=function(){return this.m_list.length>0},t.prototype.containsAsset=function(t){return!!this.hasAsset()&&-1!=this.indexOfAsset(t)},t.prototype.addAsset=function(t){-1==this.m_list.indexOf(t)&&(t.addGroup(this),this.m_list.push(t))},t.prototype.getAssetCount=function(){return this.m_list.length},t.prototype.getAssetAt=function(t){return t<0||t>=this.m_list.length?null:this.m_list[t]},t.prototype.indexOfAsset=function(t){for(var e=this.m_list.length,i=0;i<e;i++)if(this.m_list[i].getName()==t)return i;return-1},t.prototype.shiftAsset=function(){var t=this.m_list[this.m_loadIndex];return this.m_loadIndex++,this.m_current.push(t),t},t.prototype.removeCurrent=function(t){var e=this.m_current.indexOf(t);-1!=e&&this.m_current.splice(e,1),t.removeGroup(this)},t.prototype.isComplete=function(){return this.m_current.length<=0&&this.m_loadIndex>=this.m_list.length},t.prototype.isBusy=function(){return this.m_loadIndex>=this.m_list.length},t.prototype.getCompleteCount=function(){return this.m_loadIndex-this.m_current.length},t.prototype.getTotalCount=function(){return this.m_list.length},t.prototype.clear=function(){this.m_current.splice(0,this.m_current.length),this.m_list.splice(0,this.m_list.length),this.m_loadIndex=0,this.m_name=""},t}();t.LoadAssetGroup=e}(miniframe||(miniframe={})),function(t){t.ResourceConfig=function(){this.name="",this.ext="",this.folder="",this.type=t.LoadAssetTypeDefine.PREFAB,this.md5=""}}(miniframe||(miniframe={})),function(t){var e=function(){this.listener=null,this.parameter=null},i=function(){function i(){this.m_remoteRoot="",this.m_assetMap={},this.m_groupMap={},this.m_freeGroups=[],this.m_loadingGroups=[],this.m_loadingItems=[],this.m_loadingListeners={},this.m_remoteLoadHandlerMap={},this.m_remoteAssetMap={},this.m_remoteAssetTypeMap={},this.m_resourceConfigMap={},this.m_listening=!1,i.ms_instance=this}return Object.defineProperty(i,"Instance",{get:function(){return i.ms_instance||new i},enumerable:!1,configurable:!0}),i.prototype.setup=function(t){this.m_remoteRoot=t},i.prototype.addResourceConfig=function(e,i,n,o){if(this.m_resourceConfigMap[e])console.warn("resource config already exist:",e);else{var s=new t.ResourceConfig;s.name=e,s.ext=i,s.folder=n,s.type=o,this.m_resourceConfigMap[e]=s}},i.prototype.setResourceMD5=function(t,e){this.m_resourceConfigMap[t]?this.m_resourceConfigMap[t].md5=e:console.warn("resource config not exist:",t)},i.prototype.hasResource=function(t){var e=this.m_assetMap[t];return!!e&&e.getIsSaved()},i.prototype.loadResource=function(t,e,i){void 0===i&&(i=null);var n=this.createLoadAsset(t);if(!n)return console.warn("create load asset failed: "+t),void(e&&e.onLoadAssetLoadComplete(t,i));this.addLoadingListener(t,e,i),this.addLoadingItem(n)&&this.listen()},i.prototype.unloadResource=function(e){var i=this.m_assetMap[e];i&&(t.Resource.removePrefab(e),i.clear(),i=null,delete this.m_assetMap[e])},i.prototype.beginGroupLoad=function(t){i.ms_groupIDCounter++;var e=i.ms_groupIDCounter,n=this.requestLoadGroup();return n.setID(e),n.setName(t),this.m_groupMap[e]=n,e},i.prototype.addGroupLoadResource=function(t,e){if(e&&""!=e){var i=this.m_groupMap[t];if(i&&!i.containsAsset(e)){var n=this.createLoadAsset(e);n?i.addAsset(n):console.warn("create load asset failed: "+e)}}},i.prototype.endGroupLoad=function(t,e,i){void 0===i&&(i=null);var n=this.m_groupMap[t];return!!n&&(n.hasAsset()?(this.addLoadingListener(n.getName(),e,i),this.addLoadingGroup(n)&&this.listen(),!0):(this.recycleLoadGroup(n),!1))},i.prototype.addRemoteAsset=function(t,e){if(this.m_remoteAssetTypeMap[t]==cc.SpriteFrame){var i=e?new cc.SpriteFrame(e):null;this.m_remoteAssetMap[t]=i}else this.m_remoteAssetMap[t]=e;if(this.m_remoteLoadHandlerMap[t]){var n=this.m_remoteLoadHandlerMap[t];if(delete this.m_remoteLoadHandlerMap[t],n&&n.length>0)for(var o=n.length,s=0;s<o;s++)n[s].invoke(t,this.m_remoteAssetMap[t])}},i.prototype.loadRemote=function(e,i,n){if(n&&e&&""!=e)if(this.m_remoteAssetMap[e])n.invoke(e,this.m_remoteAssetMap[e]);else if(this.m_remoteLoadHandlerMap[e]){for(var o=this.m_remoteLoadHandlerMap[e],s=o.length,r=0;r<s;r++)if(o[r].compare(n))return;this.m_remoteLoadHandlerMap[e].push(n)}else if(this.m_remoteLoadHandlerMap[e]=[],this.m_remoteLoadHandlerMap[e].push(n),this.m_remoteAssetTypeMap[e]=i,i==cc.SpriteFrame&&(i=cc.Texture2D),i==cc.Texture2D){var a=t.getFileExtension(e);a&&""!=a&&"webp"!=a||(a="png"),cc.assetManager.loadRemote(e,{type:i},function(i,n){t.Loader.addRemoteAsset(e,n)})}else cc.assetManager.loadRemote(e,{type:i},function(i,n){t.Loader.addRemoteAsset(e,n)})},i.prototype.requestLoadGroup=function(){return this.m_freeGroups&&this.m_freeGroups.length>0?this.m_freeGroups.pop():new t.LoadAssetGroup},i.prototype.recycleLoadGroup=function(t){if(t){var e=t.getID();this.m_groupMap[e]&&delete this.m_groupMap[e],t.clear(),-1==this.m_freeGroups.indexOf(t)&&this.m_freeGroups.push(t)}},i.prototype.createLoadAsset=function(e){var i=this.m_assetMap[e];if(i)return i;var n=this.m_resourceConfigMap[e];return n?((i=new t.LoadAsset).setFile(n.name,n.ext,n.folder,n.type,n.md5),this.m_assetMap[e]=i,i):(console.warn("missing resource config",e),null)},i.prototype.addLoadingListener=function(t,i,n){if(i)if(this.m_loadingListeners[t]){for(var o=this.m_loadingListeners[t].length,s=0;s<o;s++)if(this.m_loadingListeners[t][s].listener==i)return;(r=new e).listener=i,r.parameter=n,this.m_loadingListeners[t].push(r)}else{var r;(r=new e).listener=i,r.parameter=n,this.m_loadingListeners[t]=[r]}},i.prototype.addLoadingGroup=function(t){return-1==this.m_loadingGroups.indexOf(t)&&(this.m_loadingGroups.push(t),!0)},i.prototype.addLoadingItem=function(t){return-1==this.m_loadingItems.indexOf(t)&&(this.m_loadingItems.push(t),!0)},i.prototype.updateLoadings=function(){var t=0;if(this.m_loadingItems.length>0)for(var e=this.m_loadingItems.length,n=0;n<e;n++)if(this.m_loadingItems[n].isComplete()){if(this.m_loadingItems[n].hasError()&&(this.m_loadingItems[n].increaseCount(),this.m_loadingItems[n].getErrorCount()<i.LOADING_FAIL_RETRY)){this.m_loadingItems[n].reset();continue}this.saveAsset(this.m_loadingItems[n]),this.notifyLoadingListenersComplete(this.m_loadingItems[n].getName());var o=this.m_loadingItems[n].getGroups();if(o&&o.length>0)for(var s=null,r=o.length,a=0;a<r;a++)(s=o[a]).removeCurrent(this.m_loadingItems[n]),this.notifyGroupProgress(s);this.m_loadingItems.splice(n,1),n--,e--}else if(this.m_loadingItems[n].isBusy())t++;else{if(t>=i.LOADING_ABREAST_MAX)continue;this.loadItem(this.m_loadingItems[n]),this.notifyItemProgress(this.m_loadingItems[n])}if(this.m_loadingGroups.length>0)for(var m=this.m_loadingGroups.length,c=0;c<m;c++)if(this.m_loadingGroups[c].isComplete())this.notifyLoadingListenersComplete(this.m_loadingGroups[c].getName()),this.m_loadingGroups.splice(c,1),c--,m--;else if(!this.m_loadingGroups[c].isBusy()){var h=this.m_loadingGroups[c].shiftAsset();this.notifyGroupProgress(this.m_loadingGroups[c]),this.addLoadingItem(h)}this.m_loadingGroups.length<=0&&this.m_loadingItems.length<=0&&this.unlisten()},i.prototype.loadItem=function(e){if(e.setState(t.LoadStateDefine.LOADING),e.getType()!=t.LoadAssetTypeDefine.SCENE){var n=!1,o=t.combinePath(e.getFolder(),e.getName()),s=e.getMD5();if(s&&""!=s&&(o=o+"_"+s+e.getExt(),o=t.combinePath(this.m_remoteRoot,o),n=!0),n)cc.assetManager.loadRemote(o,function(){i.ms_instance.notifyItemProgress(e)},function(i,n){e.setState(t.LoadStateDefine.COMPLETE),e.setError(i),e.setBody(n)});else{var r=null;switch(e.getType()){case t.LoadAssetTypeDefine.AUDIO:r=cc.AudioClip;break;case t.LoadAssetTypeDefine.ATLAS:r=cc.SpriteAtlas;break;case t.LoadAssetTypeDefine.TEXTURE:r=cc.Texture2D;break;case t.LoadAssetTypeDefine.JSON:r=cc.JsonAsset;break;case t.LoadAssetTypeDefine.SPINE:r=sp.SkeletonData;break;case t.LoadAssetTypeDefine.SPINE_ATLAS:r=cc.TextAsset}cc.resources.load(o,r,function(){i.ms_instance.notifyItemProgress(e)},function(i,n){n?!r&&n.nativeUrl?(e.setState(t.LoadStateDefine.COMPLETE),e.setError(i),e.setBody(n._nativeAsset)):(e.setState(t.LoadStateDefine.COMPLETE),e.setError(i),e.setBody(n)):(e.setState(t.LoadStateDefine.COMPLETE),e.setError(i||"load failed"),e.setBody(n))})}}else cc.director.loadScene(e.getName(),function(){e.setState(t.LoadStateDefine.COMPLETE)})},i.prototype.notifyGroupProgress=function(t){this.notifyLoadingListenersProgress(t.getName(),t.getCompleteCount(),t.getTotalCount())},i.prototype.notifyItemProgress=function(t){var e=t.getGroups();if(e&&e.length>0)for(var i=e.length,n=0;n<i;n++)this.notifyLoadingListenersProgress(e[n].getName(),e[n].getCompleteCount(),e[n].getTotalCount());else this.notifyLoadingListenersProgress(t.getName(),0,1)},i.prototype.notifyLoadingListenersProgress=function(t,e,i){var n=this.m_loadingListeners[t];if(n&&n.length>0)for(var o=n.length,s=0;s<o;s++)n[s].listener.onLoadAssetLoadProgress(t,e,i)},i.prototype.notifyLoadingListenersComplete=function(t){var e=this.m_loadingListeners[t];if(delete this.m_loadingListeners[t],e&&e.length>0)for(var i=e.length,n=0;n<i;n++)e[n].listener.onLoadAssetLoadComplete(t,e[n].parameter)},i.prototype.saveAsset=function(e){if(!e.getIsSaved()&&(e.setIsSaved(!0),!e.hasError()))switch(e.getType()){case t.LoadAssetTypeDefine.PREFAB:t.Resource.addPrefab(e.getName(),e.getBody());break;case t.LoadAssetTypeDefine.BINARY:var i=t.Config.getConfigKeyByName(e.getName());t.Config.addConfig(e.getName(),e.getFolder(),e.getBody(),i);break;case t.LoadAssetTypeDefine.ATLAS:var n=e.getName();this.m_remoteAssetMap[n]=e.getBody(),this.m_remoteAssetTypeMap[n]=cc.SpriteAtlas,t.Resource.addPrefab(e.getName(),e.getBody());break;case t.LoadAssetTypeDefine.AUDIO:t.Resource.addPrefab(e.getName(),e.getBody());break;case t.LoadAssetTypeDefine.TEXT:"string"==typeof(r=e.getBody())?t.Resource.addPrefab(e.getName(),r):r&&t.Resource.addPrefab(e.getName(),r.text);break;case t.LoadAssetTypeDefine.JSON:var o=e.getBody();o?t.Resource.addPrefab(e.getName(),o.json):console.warn("save asset fail json failed: "+e.getName());break;case t.LoadAssetTypeDefine.TEXTURE:t.Resource.addPrefab(e.getName(),e.getBody());break;case t.LoadAssetTypeDefine.SPINE:var s=e.getBody();s?t.Resource.addPrefab(e.getName(),s):console.warn("save asset fail spine failed: "+e.getName());break;case t.LoadAssetTypeDefine.SPINE_ATLAS:var r;"string"==typeof(r=e.getBody())?t.Resource.addPrefab(e.getName(),r):r&&t.Resource.addPrefab(e.getName(),r.text)}},i.prototype.listen=function(){this.m_listening||(this.m_listening=!0,t.Timer.addUpdateEventListener(this))},i.prototype.unlisten=function(){this.m_listening&&(this.m_listening=!1,t.Timer.removeUpdateEventListener(this))},i.prototype.onTimeSystemUpdate=function(){return this.updateLoadings(),!1},i.ms_instance=null,i.LOAD_KEY_REQUEST="req",i.LOADING_ABREAST_MAX=20,i.LOADING_FAIL_RETRY=3,i.ms_groupIDCounter=0,i}();t.LoadSystem=i}(miniframe||(miniframe={})),function(t){t.PrefabData=function(){this.name="",this.id=0,this.prefab=null,this.pool=null,this.total=0,this.max=0}}(miniframe||(miniframe={})),function(t){var e=function(){function e(){this.m_prefabIDCounter=0,this.m_prefabIDToName={},this.m_prefabMap={},this.m_poolMax=0,this.m_prefabPoolMax={},e.ms_instance=this}return Object.defineProperty(e,"Instance",{get:function(){return e.ms_instance||new e},enumerable:!1,configurable:!0}),e.prototype.setPoolMax=function(t){this.m_poolMax=t},e.prototype.setPrefabPoolMax=function(t,e){this.m_prefabPoolMax[t]=e},e.prototype.addPrefab=function(e,i){var n=this.m_prefabMap[e];n&&n.prefab&&n.prefab.isValid?console.warn("add prefab error: exist "+e):(n||(this.m_prefabIDCounter++,(n=new t.PrefabData).name=e,n.id=this.m_prefabIDCounter,this.m_prefabIDToName[n.id]=n.name,this.m_prefabMap[n.name]=n),n.prefab=i)},e.prototype.containsPrefab=function(t){return!(!this.m_prefabMap[t]||!this.m_prefabMap[t].prefab)},e.prototype.getPrefab=function(t){return this.m_prefabMap[t]?this.m_prefabMap[t].prefab:null},e.prototype.removePrefab=function(t){var e=this.m_prefabMap[t];e&&(e.pool&&e.pool.clear(),e.prefab=null,delete this.m_prefabMap[t])},e.prototype.createPrefabInstance=function(t){if(!t||""==t)return null;var e=this.m_prefabMap[t];return e&&e.prefab?cc.instantiate(e.prefab):(console.warn("\u8d44\u6e90\u672a\u52a0\u8f7d:"+t),null)},e.prototype.duplicatePrefabInstance=function(t){if(!t)return null;var i=t[e.UID_KEY];if(!i)return cc.instantiate(t);var n=this.m_prefabIDToName[i],o=this.requestPrefabInstance(n);return o?(o.setPosition(t.getPosition()),o.setScale(t.scale),o.angle=t.angle):(o=cc.instantiate(t))[e.UID_KEY]=t[e.UID_KEY],o},e.prototype.requestPrefabInstance=function(t){if(!t||""==t)return null;var i=this.m_prefabMap[t];if(!i||!i.prefab)return console.warn("\u8d44\u6e90\u672a\u52a0\u8f7d:"+t),null;if(i.pool||(i.pool=new cc.NodePool),i.pool.size()<=0){var n=cc.instantiate(i.prefab);return n?(n[e.UID_KEY]=i.id,n):(console.warn("\u5b9e\u4f8b\u5316\u51fa\u9519:"+t),null)}return i.pool.get()},e.prototype.recyclePrefabInstance=function(t){if(t){t.removeFromParent(!1);var i=t[e.UID_KEY];if(!i)return t.destroy(),void(t=null);var n=this.m_prefabIDToName[i],o=this.m_prefabMap[n];if(!o||!o.pool)return t.destroy(),void(t=null);var s=this.m_prefabPoolMax[n];if("number"!=typeof s&&(s=this.m_poolMax),s>0&&o.pool.size()>=s)return t.destroy(),void(t=null);o.pool.put(t)}},e.prototype.clearPrefabInstances=function(t){if(!t||""==t)return null;var e=this.m_prefabMap[t];e&&e.pool&&e.pool.clear()},e.prototype.clearAllPrefabInstances=function(){for(var t in this.m_prefabMap){var e=this.m_prefabMap[t];e&&e.pool&&e.pool.clear()}},e.UID_KEY="__miniuid__",e.ms_instance=null,e}();t.ResourceSystem=e}(miniframe||(miniframe={})),function(t){(function(t){t[t.UPDATE=0]="UPDATE",t[t.LATE_UPDATE=1]="LATE_UPDATE",t[t.FIXED_UPDATE=2]="FIXED_UPDATE"})(t.TimeTypeDefine||(t.TimeTypeDefine={}))}(miniframe||(miniframe={})),function(t){var e=function(){function t(){this.deltaTime=0,this.time=0,this.deltaMS=0,this.timeMS=0,this.frameCount=0}return t.prototype.update=function(t,e,i){this.deltaTime=t,this.time=e,this.deltaMS=Math.floor(1e3*t),this.timeMS=Math.floor(1e3*e),this.frameCount=i},t.prototype.updateMS=function(t,e,i){this.deltaTime=.001*t,this.time=.001*e,this.deltaMS=t,this.timeMS=e,this.frameCount=i},t}();t.TimeParameter=e}(miniframe||(miniframe={})),function(t){var e=function(){function t(){this.m_queue=[],this.m_addQueue=[],this.m_removeQueue=[],this.m_iterating=!1}return t.prototype.hasElement=function(){return this.m_queue.length>0},t.prototype.add=function(t){this.m_iterating?(this.addToAddQueue(t),this.removeFromRemoveQueue(t)):this.addToQueue(t)},t.prototype.remove=function(t){this.m_iterating?(this.addToRemoveQueue(t),this.removeFromAddQueue(t)):this.removeFromQueue(t)},t.prototype.shift=function(){return this.m_queue.shift()},t.prototype.clear=function(){if(this.m_iterating){this.m_addQueue.length>0&&this.m_addQueue.splice(0,this.m_addQueue.length);for(var t=this.m_queue.length,e=0;e<t;e++)this.removeFromRemoveQueue(this.m_queue[e])}else this.clearRaw()},t.prototype.clearRaw=function(){this.m_queue.length>0&&this.m_queue.splice(0,this.m_queue.length)},t.prototype.beginIterate=function(){this.m_iterating=!0},t.prototype.endIterate=function(){this.m_iterating=!1,this.flush()},t.prototype.getCount=function(){return this.m_queue.length},t.prototype.getAt=function(t){return t<0||t>=this.m_queue.length?null:this.m_queue[t]},t.prototype.flush=function(){if(this.m_removeQueue.length>0)for(var t=this.m_removeQueue.splice(0,this.m_removeQueue.length),e=t.length,i=0;i<e;i++)this.remove(t[i]);if(this.m_addQueue.length>0){var n=this.m_addQueue.splice(0,this.m_addQueue.length);for(e=n.length,i=0;i<e;i++)this.add(n[i])}},t.prototype.addToQueue=function(t){-1==this.m_queue.indexOf(t)&&this.m_queue.push(t)},t.prototype.removeFromQueue=function(t){var e=this.m_queue.indexOf(t);-1!=e&&this.m_queue.splice(e,1)},t.prototype.addToAddQueue=function(t){-1==this.m_addQueue.indexOf(t)&&this.m_addQueue.push(t)},t.prototype.removeFromAddQueue=function(t){var e=this.m_addQueue.indexOf(t);-1!=e&&this.m_addQueue.splice(e,1)},t.prototype.addToRemoveQueue=function(t){-1==this.m_removeQueue.indexOf(t)&&this.m_removeQueue.push(t)},t.prototype.removeFromRemoveQueue=function(t){var e=this.m_removeQueue.indexOf(t);-1!=e&&this.m_removeQueue.splice(e,1)},t}();t.Queue=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(e){this.m_type=t.TimeTypeDefine.UPDATE,this.m_queue=new t.Queue,this.m_parameter=null,this.m_type=e,this.m_parameter=new t.TimeParameter}return Object.defineProperty(e.prototype,"deltaTime",{get:function(){return this.m_parameter.deltaTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this.m_parameter.time},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deltaMS",{get:function(){return this.m_parameter.deltaMS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeMS",{get:function(){return this.m_parameter.timeMS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameCount",{get:function(){return this.m_parameter.frameCount},enumerable:!1,configurable:!0}),e.prototype.addListener=function(t){this.m_queue.add(t)},e.prototype.removeListener=function(t){this.m_queue.remove(t)},e.prototype.update=function(t,e,i){if(this.m_parameter.update(t,e,i),this.m_queue.hasElement()){this.m_queue.beginIterate();for(var n=this.m_queue.getCount(),o=0;o<n&&1!=this.onQueueIterate(this.m_queue.getAt(o));o++);this.m_queue.endIterate()}},e.prototype.updateMS=function(t,e,i){if(this.m_parameter.updateMS(t,e,i),this.m_queue.hasElement()){this.m_queue.beginIterate();for(var n=this.m_queue.getCount(),o=0;o<n&&1!=this.onQueueIterate(this.m_queue.getAt(o));o++);this.m_queue.endIterate()}},e.prototype.onQueueIterate=function(e){if(this.m_type==t.TimeTypeDefine.LATE_UPDATE){if(e)return e.onTimeSystemLateUpdate(this.deltaMS,this.timeMS)}else if(this.m_type==t.TimeTypeDefine.UPDATE){if(e)return e.onTimeSystemUpdate(this.deltaMS,this.timeMS)}else if(this.m_type==t.TimeTypeDefine.FIXED_UPDATE&&e)return e.onTimeSystemFixedUpdate(this.deltaMS,this.timeMS);return!1},e}();t.TimeUpdater=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(){this.m_updater=new t.TimeUpdater(t.TimeTypeDefine.UPDATE),this.m_lateUpdater=new t.TimeUpdater(t.TimeTypeDefine.LATE_UPDATE),this.m_fixedUpdater=new t.TimeUpdater(t.TimeTypeDefine.FIXED_UPDATE),this.m_isFixedUpdating=!1,this.m_fixedDeltaMS=0,this.m_fixedTimeMS=0,this.m_fixedFrameCount=0,this.m_fixedDeltaLeftMS=0,e.ms_instance=this}return Object.defineProperty(e,"Instance",{get:function(){return e.ms_instance||new e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deltaMS",{get:function(){return this.m_updater.deltaMS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeMS",{get:function(){return this.m_updater.timeMS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameCount",{get:function(){return this.m_updater.frameCount},enumerable:!1,configurable:!0}),e.prototype.setFixedDeltaMS=function(t){this.m_fixedDeltaMS=t},e.prototype.addUpdateEventListener=function(t){this.m_updater.addListener(t)},e.prototype.removeUpdateEventListener=function(t){this.m_updater.removeListener(t)},e.prototype.addLateUpdateEventListener=function(t){this.m_lateUpdater.addListener(t)},e.prototype.removeLateUpdateEventListener=function(t){this.m_lateUpdater.removeListener(t)},e.prototype.addFixedUpdateEventListener=function(t){this.m_fixedUpdater.addListener(t)},e.prototype.removeFixedUpdateEventListener=function(t){this.m_fixedUpdater.removeListener(t)},e.prototype.update=function(t,e,i){this.m_isFixedUpdating?this.fixedUpdate(t):this.m_updater.update(t,e,i)},e.prototype.lateUpdate=function(t,e,i){this.m_isFixedUpdating||this.m_lateUpdater.update(t,e,i)},e.prototype.openFixedUpdate=function(){this.m_isFixedUpdating||(this.m_isFixedUpdating=!0,this.m_fixedTimeMS=0,this.m_fixedFrameCount=0,this.m_fixedDeltaLeftMS=0)},e.prototype.closeFixedUpdate=function(){this.m_isFixedUpdating&&(this.m_isFixedUpdating=!1)},e.prototype.fixedUpdate=function(t){var e=Math.floor(1e3*t);for(e+=this.m_fixedDeltaLeftMS;e>=this.m_fixedDeltaMS;)e-=this.m_fixedDeltaMS,this.m_fixedTimeMS+=this.m_fixedDeltaMS,this.m_fixedFrameCount++,this.m_updater.updateMS(this.m_fixedDeltaMS,this.m_fixedTimeMS,this.m_fixedFrameCount),this.m_fixedUpdater.updateMS(this.m_fixedDeltaMS,this.m_fixedTimeMS,this.m_fixedFrameCount),this.m_lateUpdater.updateMS(this.m_fixedDeltaMS,this.m_fixedTimeMS,this.m_fixedFrameCount);this.m_fixedDeltaLeftMS=e},e.ms_instance=null,e}();t.TimeSystem=e}(miniframe||(miniframe={})),function(t){t.UIData=function(){this.resourceName="",this.layer=0,this.obj=null,this.isConst=!1,this.needLoading=!1,this.isLoading=!1}}(miniframe||(miniframe={})),function(t){var e=function(){function e(t){this.m_layerQueue=[],this.m_layers={},this.m_root=null,this.m_root=t}return e.prototype.setRoot=function(t){if(this.m_root!=t){var e=this.m_root;if(this.m_root=t,e&&this.m_root)for(var i=this.m_layerQueue.length,n=0;n<i;n++)this.m_layerQueue[n].removeFromParent(!1),this.m_layerQueue[n].group!=this.m_root.group&&(this.m_layerQueue[n].group=this.m_root.group),this.m_root.addChild(this.m_layerQueue[n])}},e.prototype.getLayerNodes=function(){return this.m_layerQueue},e.prototype.getLayerNode=function(t){return this.m_layers[t]},e.prototype.requestLayerNode=function(t,e){if(!this.m_layers[t]){if(!e)return null;this.addLayer(t)}return this.m_layers[t]},e.prototype.addLayer=function(e){var i=t.createWidget(e+"");i.layerIndex=e,i.group!=this.m_root.group&&(i.group=this.m_root.group),this.m_layers[e]=i;for(var n=this.m_layerQueue.length,o=0;o<n;o++)if(e<this.m_layerQueue[o].layerIndex)return this.m_root.insertChild(i,this.m_layerQueue[o].getSiblingIndex()),void this.m_layerQueue.splice(o,0,i);this.m_layerQueue.push(i),this.m_root.addChild(i)},e.prototype.setLayerNode=function(t,e){return!this.m_layers[t]&&(this.m_layers[t]=e,!0)},e}();t.LayerHub=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(){this.m_uiMap={},this.m_uiListenerMap={},this.m_uiRoot=null,this.m_uiCamera=null,this.m_uiLayer=null,this.m_canvasNode=null,this.m_uiFontFamily="",this.m_loadingMediatorName="",this.m_loadingData=null,this.m_loadingVisualAgent=null,this.m_blockEvent=!1,e.ms_instance=this}return Object.defineProperty(e,"Instance",{get:function(){return e.ms_instance||new e},enumerable:!1,configurable:!0}),e.prototype.setup=function(e,i,n){void 0===n&&(n=""),this.m_uiRoot=e,this.m_uiCamera=i,this.m_uiLayer=new t.LayerHub(this.m_uiRoot),this.m_canvasNode=this.findCanvasNodeInParent(e),this.m_uiFontFamily=n},e.prototype.findCanvasNodeInParent=function(t){var e=t.getParent();return e?e.getComponent(cc.Canvas)?e:this.findCanvasNodeInParent(e):null},e.prototype.setLoadingMediatorName=function(t){this.m_loadingMediatorName=t},e.prototype.blockEvent=function(){this.m_blockEvent||(this.m_blockEvent=!0,this.m_uiRoot.pauseSystemEvents(!0))},e.prototype.unblockEvent=function(){this.m_blockEvent&&(this.m_blockEvent=!1,this.m_uiRoot.resumeSystemEvents(!0))},e.prototype.isEventBlocked=function(){return this.m_blockEvent},e.prototype.getUIRoot=function(){return this.m_uiRoot},e.prototype.getUINodeGroup=function(){return this.m_uiRoot?this.m_uiRoot.group:""},e.prototype.getUIFontFamily=function(){return this.m_uiFontFamily},e.prototype.getUIWidth=function(){return this.m_uiRoot?this.m_uiRoot.width:0},e.prototype.getUIHeight=function(){return this.m_uiRoot?this.m_uiRoot.height:0},e.prototype.toUIPosition=function(t){return this.m_uiRoot?this.m_uiRoot.convertToNodeSpaceAR(t):t},e.prototype.toWorldPosition=function(t){return this.m_uiRoot?this.m_uiRoot.convertToWorldSpaceAR(t):t},e.prototype.getUILayer=function(t,e){return void 0===e&&(e=!1),this.requestLayerNode(t,e)},e.prototype.requestLayerNode=function(t,e){return this.m_uiLayer.requestLayerNode(t,e)},e.prototype.show=function(e,i,n,o,s){void 0===s&&(s=!1);var r=this.m_uiMap[e];if(r){if(r.isLoading)return;r.obj&&r.obj.isValid?(r.layer=i,r.isConst!=n&&(r.isConst=n,r.isConst?cc.game.addPersistRootNode(r.obj):cc.game.removePersistRootNode(r.obj)),this.addChild(r.obj,r.layer),o&&o.handleUIMediatorShowComplete(r.obj)):(r.layer=i,r.isConst=n,r.needLoading=s,r.isLoading=!0,this.m_uiListenerMap[e]=o,r.needLoading&&this.m_loadingMediatorName&&""!=this.m_loadingMediatorName?(this.m_loadingData||(this.m_loadingData=[]),-1==this.m_loadingData.indexOf(r)&&this.m_loadingData.push(r),t.Facade.openMediator(this.m_loadingMediatorName,this)):t.Loader.loadResource(e,this))}else(r=new t.UIData).resourceName=e,r.layer=i,r.isConst=n,r.needLoading=s,this.m_uiMap[e]=r,t.Resource.containsPrefab(e)?(r.obj=t.Resource.createPrefabInstance(e),r.isConst&&cc.game.addPersistRootNode(r.obj),this.addChild(r.obj,r.layer),o&&o.handleUIMediatorShowComplete(r.obj)):(r.isLoading=!0,this.m_uiListenerMap[e]=o,r.needLoading&&this.m_loadingMediatorName&&""!=this.m_loadingMediatorName?(this.m_loadingData||(this.m_loadingData=[]),-1==this.m_loadingData.indexOf(r)&&this.m_loadingData.push(r),t.Facade.openMediator(this.m_loadingMediatorName,this)):t.Loader.loadResource(e,this))},e.prototype.hide=function(e,i,n){var o=this.m_uiMap[e];o&&(n&&t.Loader.unloadResource(o.resourceName),o.obj&&(this.removeChild(o.obj,n),n&&(o.obj=null))),n&&delete this.m_uiMap[e],i&&i.handleUIMediatorHideComplete()},e.prototype.dispose=function(e){var i=this.m_uiMap[e];i&&(t.Loader.unloadResource(i.resourceName),i.obj&&(i.obj.destroy(),i.obj=null)),delete this.m_uiMap[e]},e.prototype.addChild=function(t,e){if(t){var i=this.requestLayerNode(e,!0);i!=t.getParent()&&(t.getParent()&&t.removeFromParent(!1),i&&i.addChild(t))}},e.prototype.addLazyChild=function(t,e){if(t){var i=this.requestLayerNode(e,!0);t.setParent(i)}},e.prototype.removeChild=function(t,e){t&&(t.removeFromParent(!1),e&&(t.destroy(),t=null))},e.prototype.moveToTop=function(e){e&&t.moveToTop(e)},e.prototype.moveToBottom=function(e){e&&t.moveToBottom(e)},e.prototype.onLoadAssetLoadProgress=function(t,e,i){this.m_loadingVisualAgent&&this.m_loadingVisualAgent.showProgress(t,e/i)},e.prototype.onLoadAssetLoadComplete=function(e){var i=this.m_uiMap[e];if(!t.Resource.containsPrefab(e))return console.warn("init ui prefab error "+e),void(i.needLoading&&this.onProgressVisualAgentShowComplete());var n=t.Resource.createPrefabInstance(e);n.group!=this.m_uiRoot.group&&(n.group=this.m_uiRoot.group),i.obj=n,i.isLoading=!1,i.isConst&&(cc.game.addPersistRootNode(i.obj),t.Resource.removePrefab(e),t.Loader.unloadResource(e)),this.addChild(i.obj,i.layer);var o=this.m_uiListenerMap[e];o&&(o.handleUIMediatorShowComplete(n),delete this.m_uiListenerMap[e]),i.needLoading&&this.onProgressVisualAgentShowComplete()},e.prototype.setProgressVisualAgent=function(t){this.m_loadingVisualAgent=t},e.prototype.onProgressVisualAgentShowComplete=function(){if(this.m_loadingData.length>0){var e=this.m_loadingData.shift();t.Loader.loadResource(e.resourceName,this)}else t.Facade.closeMediator(this.m_loadingMediatorName)},e.prototype.onProgressVisualAgentHideComplete=function(){this.m_loadingVisualAgent=null},e.ms_instance=null,e}();t.UISystem=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(){this.m_uidCounter=0,this.m_freeClips=[],this.m_busyClips={},this.m_playingIDs=[],t.TimeSystem.Instance.addUpdateEventListener(this)}return Object.defineProperty(e,"Instance",{get:function(){return e.ms_instance||new e},enumerable:!1,configurable:!0}),e.prototype.playAudio=function(e,i,n,o){void 0===i&&(i=!1),void 0===n&&(n=1),void 0===o&&(o=!1),this.m_uidCounter++;var s=this.requestAudio();s.setUID(this.m_uidCounter),s.setLoop(i),s.setVolume(n),s.setIsMusic(o),s.loadResource(e),s.play();var r=s.getPlayID();return t.safePush(this.m_playingIDs,r),r},e.prototype.requestAudio=function(){return this.m_freeClips.length>0?this.m_freeClips.pop():new t.AudioClip},e.prototype.isAudioPlaying=function(t){var e=this.m_busyClips[t];return!!e&&e.isPlaying()},e.prototype.stopAudio=function(t){var e=this.m_busyClips[t];e&&e.stop()},e.prototype.pauseAudio=function(t){var e=this.m_busyClips[t];e&&e.pause()},e.prototype.resumeAudio=function(t){var e=this.m_busyClips[t];e&&e.resume()},e.prototype.setAudioVolume=function(t,e){var i=this.m_busyClips[t];i&&i.setVolume(e)},e.prototype.checkComplete=function(t){var e=this.m_busyClips[t];return!e||!e.isPlaying()&&(this.recycleClip(t,e),!0)},e.prototype.recycleClip=function(e,i){delete this.m_busyClips[e],i.unloadResource(),t.safePush(this.m_freeClips,i)},e.prototype.onTimeSystemUpdate=function(){if(this.m_playingIDs.length>0)for(var t=this.m_playingIDs.length-1;t>=0;t--)this.checkComplete(this.m_playingIDs[t])&&this.m_playingIDs.splice(t,1);return!1},e.ms_instance=null,e}();t.AudioSystem=e}(miniframe||(miniframe={})),function(t){(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.IDLE=1]="IDLE",t[t.RUNNING=2]="RUNNING",t[t.DISPOSED=3]="DISPOSED"})(t.ModuleStateDefine||(t.ModuleStateDefine={}))}(miniframe||(miniframe={})),function(t){(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.MAIN=1]="MAIN",t[t.BOTH=2]="BOTH"})(t.ModuleTypeDefine||(t.ModuleTypeDefine={}))}(miniframe||(miniframe={})),function(t){t.ModuleConfig=function(){this.name="",this.type=t.ModuleTypeDefine.BACKGROUND,this.entryCommand="",this.entryMediator="",this.entryParameter=null,this.isEntryModule=!1,this.isDefaultModule=!1,this.isAutoLaunch=!1,this.isAutoDispose=!1,this.isAutoNext=!1,this.nextModules=null,this.backgroundModules=null,this.initializerClass=null}}(miniframe||(miniframe={})),function(t){t.ModuleData=function(){this.state=t.ModuleStateDefine.UNKNOWN,this.config=null,this.initializer=null}}(miniframe||(miniframe={})),function(t){var e=function(){function e(){this.m_modules={},this.m_lastModule=null,this.m_currentModule=null,this.m_autoLaunchModules=[],this.m_entryModuleName="",this.m_defaultModuleName="",e.ms_instance=this}return Object.defineProperty(e,"Instance",{get:function(){return e.ms_instance||new e},enumerable:!1,configurable:!0}),e.prototype.setup=function(t){for(var e=t.length,i=0;i<e;i++)this.register(t[i])},e.prototype.startup=function(t){if(void 0===t&&(t=null),this.m_autoLaunchModules.length>0)for(;this.m_autoLaunchModules.length>0;){var e=this.m_autoLaunchModules[0];this.m_autoLaunchModules.splice(0,1),this.launch(e)}""!=this.m_entryModuleName?this.launch(this.m_entryModuleName,t):console.info("Missing entry module.")},e.prototype.register=function(e){var i=this.m_modules[e.name];if(!i)return(i=new t.ModuleData).config=e,this.m_modules[e.name]=i,e.type==t.ModuleTypeDefine.MAIN&&(e.isEntryModule&&(this.m_entryModuleName=e.name),e.isDefaultModule&&(this.m_defaultModuleName=e.name)),e.isAutoLaunch&&-1==this.m_autoLaunchModules.indexOf(e.name)&&this.m_autoLaunchModules.push(e.name),!0;console.warn("already register module "+e.name)},e.prototype.isModuleRunning=function(e){var i=this.m_modules[e];return!!i&&i.state==t.ModuleStateDefine.RUNNING},e.prototype.launch=function(e,i){void 0===i&&(i=null);var n=this.m_modules[e];n?n.state!=t.ModuleStateDefine.RUNNING&&(n.config.type!=t.ModuleTypeDefine.MAIN&&n.config.type!=t.ModuleTypeDefine.BOTH||(this.m_lastModule=this.m_currentModule,this.m_currentModule&&(this.m_currentModule.config.type==t.ModuleTypeDefine.MAIN&&this.stopModule(this.m_currentModule),this.m_currentModule=null)),this.launchModule(n,i)):console.warn("cannot launch module "+e+", unregister")},e.prototype.stop=function(t){var e=this.m_modules[t];e&&this.stopModule(e)},e.prototype.back=function(){this.m_lastModule?this.launch(this.m_lastModule.config.name):this.backDefault()},e.prototype.backDefault=function(){this.m_defaultModuleName&&""!=this.m_defaultModuleName&&this.launch(this.m_defaultModuleName)},e.prototype.next=function(t){void 0===t&&(t=null),this.m_currentModule&&this.nextTo(this.m_currentModule.config.nextModules,t)},e.prototype.nextTo=function(t,e){if(void 0===e&&(e=null),t){var i=t;if(i)for(var n=i.length,o=0;o<n;o++)this.launch(i[o],e);else this.launch(t,e)}},e.prototype.launchModule=function(e,i){if(void 0===i&&(i=null),e.initializer||e.config.initializerClass&&(e.initializer=e.config.initializerClass()),e.initializer&&e.initializer.initialize(),e.state=t.ModuleStateDefine.RUNNING,(e.config.type==t.ModuleTypeDefine.MAIN||e.config.type==t.ModuleTypeDefine.BOTH)&&(this.m_currentModule=e,e.config.backgroundModules&&e.config.backgroundModules.length>0))for(var n=e.config.backgroundModules.length,o=0;o<n;o++)this.launch(e.config.backgroundModules[o]);t.Facade.openMediator(e.config.entryMediator,i||e.config.entryParameter),t.Facade.sendNotification(e.config.entryCommand,i||e.config.entryParameter),e.config.type!=t.ModuleTypeDefine.MAIN&&e.config.type!=t.ModuleTypeDefine.BOTH||e.config.isAutoNext&&this.next()},e.prototype.stopModule=function(e){t.Facade.closeMediator(e.config.entryMediator),e.initializer&&e.initializer.uninitialize(),e.state=t.ModuleStateDefine.IDLE,e.config.isAutoDispose&&(e.state=t.ModuleStateDefine.DISPOSED,e.initializer&&(e.initializer.dispose(),e.initializer=null))},e.ms_instance=null,e}();t.ModuleSystem=e}(miniframe||(miniframe={})),function(t){var e;(function(t){t[t.None=0]="None",t[t.OpenWait=1]="OpenWait",t[t.Open=2]="Open",t[t.CloseWait=3]="CloseWait",t[t.Close=4]="Close"})(e||(e={}));var i=function(t){function i(i,n){void 0===n&&(n=null);var o=t.call(this,i,n)||this;return o.m_interestNotifications=null,o.m_state=e.None,o.m_nextState=e.None,o}return __extends(i,t),i.prototype.listNotificationInterests=function(){return this.m_interestNotifications||(this.m_interestNotifications=[],this.onInitInterestNotifications(this.m_interestNotifications)),this.m_interestNotifications},i.prototype.handleNotification=function(t){this.onHandleNotification(t.getName(),t.getBody())},i.prototype.sendNotification=function(e,i){void 0===i&&(i=null),t.prototype.sendNotification.call(this,e,i,"")},i.prototype.onRegister=function(){this.m_state!=e.Open&&this.m_state!=e.OpenWait&&(this.m_state!=e.CloseWait?(this.m_state=e.OpenWait,t.prototype.onRegister.call(this),this.onMediatorOpen(this.viewComponent)):this.m_nextState=e.Open)},i.prototype.onRemove=function(){this.m_state!=e.Close&&this.m_state!=e.CloseWait&&(this.m_state!=e.OpenWait?(this.m_state=e.CloseWait,t.prototype.onRemove.call(this),this.onMediatorClose(this.viewComponent)):this.m_nextState=e.Close)},i.prototype.onRefresh=function(){this.onMediatorRefresh(this.viewComponent)},i.prototype.onSetOpenState=function(){this.m_state=e.Open;var t=this.m_nextState==e.Close;this.m_nextState=e.None,t&&this.onRemove()},i.prototype.checkOpenState=function(){var t=this.m_nextState==e.Close;return this.m_nextState=e.None,t&&(this.m_state=e.Open,this.onRemove()),!t},i.prototype.onSetCloseState=function(){this.m_state=e.Close;var t=this.m_nextState==e.Open;this.m_nextState=e.None,t&&this.onRegister()},i.prototype.onInitInterestNotifications=function(){},i.prototype.onHandleNotification=function(){},i.prototype.onMediatorOpen=function(){this.onSetOpenState()},i.prototype.onMediatorClose=function(){this.onSetCloseState()},i.prototype.onMediatorRefresh=function(){},i.prototype.onMediatorDispose=function(){},i.prototype.dispose=function(){this.onMediatorDispose(),this.setViewComponent(null)},i}(puremvc.Mediator);t.AbstractMediator=i}(miniframe||(miniframe={})),function(t){var e=function(e){function i(){var t=e.call(this,"Mini")||this;return t.m_mediatorClassRefs={},t.m_mediators={},t.m_shownMediators={},i.ms_instance=t,t}return __extends(i,e),Object.defineProperty(i,"Instance",{get:function(){return i.ms_instance||new i},enumerable:!1,configurable:!0}),i.prototype.findMediatorClass=function(t){return this.m_mediatorClassRefs[t]},i.prototype.findMediator=function(t){return this.m_mediators[t]},i.prototype.isMediatorOpened=function(t){return!!this.m_shownMediators[t]},i.prototype.openMediator=function(t,i,n){if(void 0===i&&(i=null),void 0===n&&(n=!1),t&&""!=t)if(this.m_shownMediators[t]){if(n){var o=this.m_shownMediators[t];o&&(o.setViewComponent(i),o.onRefresh())}}else{var s=this.findMediator(t);if(!s){var r=this.findMediatorClass(t);if(!r)return void console.info("Open mediator "+t+" failed: mediator class is null.");s=r(),this.m_mediators[t]=s}this.m_shownMediators[t]=s,s.setViewComponent(i),e.prototype.registerMediator.call(this,s)}},i.prototype.closeMediator=function(t,i){if(void 0===i&&(i=null),t&&""!=t&&this.m_shownMediators[t]){delete this.m_shownMediators[t];var n=this.findMediator(t);n?(n.setViewComponent(i),e.prototype.removeMediator.call(this,n.getMediatorName())):console.info("Close mediator "+t+" failed: mediator is null.")}},i.prototype.disposeMediator=function(t){this.closeMediator(t);var e=this.findMediator(t);if(e){delete this.m_mediators[t];var i=e;i&&(i.dispose(),i=null)}},i.prototype.registerMediatorClass=function(t,e){this.m_mediatorClassRefs[t]||(this.m_mediatorClassRefs[t]=e)},i.prototype.unregisterMediatorClass=function(t){delete this.m_mediatorClassRefs[t]},i.prototype.registerCommand=function(t,i){e.prototype.registerCommand.call(this,t,i)},i.prototype.unregisterCommand=function(t){e.prototype.removeCommand.call(this,t)},i.prototype.sendNotificationAsync=function(e,i,n){void 0===i&&(i=null),void 0===n&&(n=""),e&&""!=e&&setTimeout(function(){t.Facade.sendNotification(e,i,n)},1/cc.game.getFrameRate())},i.ms_instance=null,i.STEP_READY=0,i.STEP_START_SCENE=1,i.STEP_MAIN_CONFIG=2,i.STEP_PRELOAD_CONFIG=3,i.STEP_END=4,i}(puremvc.Facade);t.MiniFacade=e}(miniframe||(miniframe={})),function(t){t.post2=function(i){return(new e).setRequestType(t.HTTPRequestTypeDefine.POST).setURL(i)},t.get2=function(i){return(new e).setRequestType(t.HTTPRequestTypeDefine.GET).setURL(i)};var e=function(){function e(e){void 0===e&&(e=!0),this.m_url="",this.m_data=null,this.m_header=null,this.m_requestType=t.HTTPRequestTypeDefine.POST,this.m_responseType=t.HTTPResponseTypeDefine.TEXT,this.m_encodeType=t.HTTPEncodeTypeDefine.URLENCODED,this.m_charset="UTF-8",this.m_retry=10,this.m_retryInterval=1e3,this.m_callback=null,this.m_callbackTarget=null,this.m_autoDispose=!1,this.m_autoDispose=e}return e.prototype.setURL=function(t){return this.m_url=t,this},e.prototype.setData=function(t){if(this.m_data)for(var e in t)this.m_data[e]=t[e];else this.m_data=t;return this},e.prototype.addData=function(t,e){return this.m_data||(this.m_data={}),this.m_data[t]=e,this},e.prototype.setHeader=function(t){if(this.m_header)for(var e in t)this.m_header[e]=t[e];else this.m_header=t;return this},e.prototype.addHeader=function(t,e){return this.m_header||(this.m_header={}),this.m_header[t]=e,this},e.prototype.setRequestType=function(t){return this.m_requestType=t,this},e.prototype.setResponseType=function(t){return this.m_responseType=t,this},e.prototype.setEncodeType=function(t){return this.m_encodeType=t,this},e.prototype.setCharSet=function(t){return this.m_charset=t,this},e.prototype.setRetry=function(t){return this.m_retry=t,this},e.prototype.setRetryInterval=function(t){return this.m_retryInterval=t,this},e.prototype.setCallback=function(t,e){return void 0===e&&(e=null),this.m_callback=t,this.m_callbackTarget=e,this},e.prototype.retryForever=function(t){return void 0===t&&(t=1e3),this.m_retry=Number.MAX_VALUE,this.m_retryInterval=t,this},e.prototype.send=function(){this.httpRequest(this,this.m_url,this.m_data,this.m_header,this.m_requestType,this.m_responseType,this.m_encodeType,this.m_charset)},e.prototype.onLoad=function(e){200==e.status?this.m_callback&&(this.m_responseType==t.HTTPResponseTypeDefine.ARRAYBUFFER?this.m_callback.call(this.m_callbackTarget,!0,new Uint8Array(e.response)):this.m_callback.call(this.m_callbackTarget,!0,e.responseText)):this.onError(e.status),this.m_autoDispose&&this.dispose()},e.prototype.onError=function(t){var e=this;console.info("www request failed",this.m_url,t),this.m_retry>0?(this.m_retry--,this.m_retryInterval>0?setTimeout(function(){e.send()},this.m_retryInterval):this.send()):(this.m_callback&&this.m_callback.call(this.m_callbackTarget,!1,t),this.m_autoDispose&&this.dispose())},e.prototype.dispose=function(){this.m_callback=null,this.m_callbackTarget=null},e.prototype.httpRequest=function(t,e,i,n,o,s,r,a){var m=new XMLHttpRequest;if(m.open(o,e,!0),m.setRequestHeader("Content-Type",r+";charset="+a),n)for(var c in n)m.setRequestHeader(c,n[c]);if(m.responseType=s,m.onload=function(){t.onLoad(m)},m.onerror=function(e){t.onError(e)},i){var h="",u=0;for(var c in i)u>0&&(h+="&"),h+=c+"="+i[c],u++;m.send(h)}else m.send("")},e}();t.WWW=e}(miniframe||(miniframe={})),function(t){t.Version=111,t.Config=t.ConfigSystem.Instance,t.Loader=t.LoadSystem.Instance,t.Resource=t.ResourceSystem.Instance,t.Timer=t.TimeSystem.Instance,t.UI=t.UISystem.Instance,t.Audio=t.AudioSystem.Instance,t.Modules=t.ModuleSystem.Instance,t.Facade=t.MiniFacade.Instance}(miniframe||(miniframe={})),function(t){var e=function(){function e(){this.m_resource="",this.m_lastResource="",this.m_autoUnload=!1,this.m_isLoading=!1,this.m_loadCallback=null,this.m_loadCallbackTarget=null}return e.prototype.setAutoUnload=function(t){this.m_autoUnload=t},e.prototype.setLoadCallback=function(t,e){this.m_loadCallback=t,this.m_loadCallbackTarget=e},e.prototype.compareResource=function(t){return this.m_resource==t},e.prototype.setEmptyResource=function(){this.m_resource=e.EMPTY_RESOURCE},e.prototype.setResource=function(t){this.m_resource=t},e.prototype.getResource=function(){return this.m_resource},e.prototype.loadResource=function(e,i){return void 0===i&&(i=!1),!(this.m_resource==e||!e||""==e||(i?(this.unloadResource(),this.m_lastResource=""):this.m_lastResource=this.m_resource,this.m_resource=e,this.m_isLoading=!0,t.Resource.containsPrefab(this.m_resource)?(this.m_isLoading=!1,this.onInitPrefab(this.m_resource),this.m_loadCallback&&this.m_loadCallback.call(this.m_loadCallbackTarget,this)):t.Loader.loadResource(this.m_resource,this),0))},e.prototype.unloadResource=function(){this.isEmptyResource()||this.m_resource&&""!=this.m_resource&&this.m_autoUnload&&(t.Loader.unloadResource(this.m_resource),this.m_lastResource&&""!=this.m_lastResource&&t.Loader.unloadResource(this.m_lastResource)),this.onUnInitPrefab(this.m_resource),this.m_resource="",this.m_lastResource="",this.m_isLoading=!1},e.prototype.unloadLastResource=function(){this.m_lastResource&&""!=this.m_lastResource&&(this.m_autoUnload&&t.Loader.unloadResource(this.m_lastResource),this.onUnInitPrefab(this.m_lastResource),this.m_lastResource="")},e.prototype.getPrefabInstance=function(){return!this.m_resource||""==this.m_resource||this.m_isLoading?null:t.Resource.requestPrefabInstance(this.m_resource)},e.prototype.isEmptyResource=function(){return this.m_resource==e.EMPTY_RESOURCE},e.prototype.onInitPrefab=function(){},e.prototype.onUnInitPrefab=function(){},e.prototype.isLoading=function(){return this.m_isLoading},e.prototype.dispose=function(){this.unloadResource()},e.prototype.onLoadAssetLoadProgress=function(){},e.prototype.onLoadAssetLoadComplete=function(t){this.m_resource==t&&(this.unloadLastResource(),this.m_isLoading=!1,this.onInitPrefab(this.m_resource),this.m_loadCallback&&this.m_loadCallback.call(this.m_loadCallbackTarget,this))},e.EMPTY_RESOURCE="__empty__",e}();t.LazyLoader=e}(miniframe||(miniframe={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.m_uid=0,t.m_isLoop=!1,t.m_volume=1,t.m_isMusic=!1,t.m_clip=null,t.m_playing=!1,t.m_playID=NaN,t}return __extends(i,e),i.prototype.setUID=function(t){this.m_uid=t},i.prototype.getUID=function(){return this.m_uid},i.prototype.onInitPrefab=function(i){e.prototype.onInitPrefab.call(this,i),this.m_clip=t.Resource.getPrefab(i),this.onPlay()},i.prototype.onUnInitPrefab=function(t){isNaN(this.m_playID)||cc.audioEngine.stop(this.m_playID),this.m_playID=NaN,this.m_clip=null,e.prototype.onUnInitPrefab.call(this,t)},i.prototype.setLoop=function(t){this.m_isLoop=t},i.prototype.setVolume=function(t){this.m_volume=t,isNaN(this.m_playID)||cc.audioEngine.setVolume(this.m_playID,this.m_volume)},i.prototype.setIsMusic=function(t){this.m_isMusic=t},i.prototype.play=function(){this.m_playing||(this.m_playing=!0,this.onPlay())},i.prototype.onPlay=function(){this.m_playing&&(this.isLoading()||(this.m_clip?(this.m_isMusic?this.m_playID=cc.audioEngine.playMusic(this.m_clip,this.m_isLoop):this.m_playID=cc.audioEngine.playEffect(this.m_clip,this.m_isLoop),1!=this.m_volume&&cc.audioEngine.setVolume(this.m_playID,this.m_volume)):this.m_playID=NaN))},i.prototype.getPlayID=function(){return this.m_playID},i.prototype.isPlaying=function(){return!!this.isLoading()||!isNaN(this.m_playID)&&cc.audioEngine.getState(this.m_playID)==cc.audioEngine.AudioState.PLAYING},i.prototype.stop=function(){isNaN(this.m_playID)&&cc.audioEngine.stop(this.m_playID)},i.prototype.pause=function(){isNaN(this.m_playID)&&cc.audioEngine.pause(this.m_playID)},i.prototype.resume=function(){isNaN(this.m_playID)&&cc.audioEngine.resume(this.m_playID)},i}(t.LazyLoader);t.AudioClip=e}(miniframe||(miniframe={})),function(t){var e=function(){function t(){}return t.CONFIG_LOAD_KEY="Configs_",t.CONFIG_FOLDER="Config",t}();t.ConfigKeyNames=e}(miniframe||(miniframe={})),function(t){var e=function(){function t(){this.m_fileKeyToNameMap={},this.m_fileNameToKeyMap={}}return t.prototype.add=function(t,e){this.m_fileKeyToNameMap[t]=e,this.m_fileNameToKeyMap[e]=t},t.prototype.initialize=function(){},t.prototype.getName=function(t){return this.m_fileKeyToNameMap[t]},t.prototype.getKey=function(t){return this.m_fileNameToKeyMap[t]},t.prototype.getDataCreator=function(){return null},t.prototype.getProtoCreator=function(){return null},t}();t.ConfigSettings=e}(miniframe||(miniframe={})),function(t){var e=function(){function t(){}return t.URLENCODED="application/x-www-form-urlencoded",t.JSON="application/json",t.MULTIPART="multipart/form-data",t}();t.HTTPEncodeTypeDefine=e}(miniframe||(miniframe={})),function(t){var e=function(){function t(){}return t.GET="GET",t.POST="POST",t}();t.HTTPRequestTypeDefine=e}(miniframe||(miniframe={})),function(t){var e=function(){function t(){}return t.TEXT="text",t.ARRAYBUFFER="arraybuffer",t.JSON="json",t}();t.HTTPResponseTypeDefine=e}(miniframe||(miniframe={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.m_visibleState=0,t.m_node=null,t.m_parent=null,t.m_parentChanged=!1,t.m_pos=cc.Vec2.ZERO,t.m_posChanged=!1,t.m_scale=cc.Vec2.ZERO,t.m_scaleChanged=!1,t.m_angle=0,t.m_angleChanged=!1,t.m_width=0,t.m_widthChanged=!1,t.m_height=0,t.m_heightChanged=!1,t.m_alpha=1,t.m_alphaChanged=!1,t.m_color=cc.Color.WHITE,t.m_colorChanged=!1,t.m_colorIncludeChildren=!1,t.m_nodeGroup="",t.m_nodeGroupChanged=!1,t.m_act=null,t.m_autoDestroyNode=!1,t.m_animation=null,t.m_animationName="",t.m_animationCallback=null,t.m_animationCallbackTarget=null,t.m_particle=null,t.m_resetParticleOnLoad=!1,t}return __extends(i,e),i.prototype.setAutoDestroyNode=function(t){this.m_autoDestroyNode=t},i.prototype.isAutoDestroyNode=function(){return this.m_autoDestroyNode},i.prototype.createEmpty=function(){this.setEmptyResource(),this.m_node=t.createNode("LazyNode"),this.onInitNode(this.m_node)},i.prototype.setParent=function(t){this.m_parent!=t&&(this.m_parent=t,this.m_node&&this.m_node.getParent()!=this.m_parent&&(this.m_node.removeFromParent(!1),this.m_parent&&this.m_parent.addChild(this.m_node)),this.m_parentChanged=!0)},i.prototype.setPosition=function(t){this.m_pos.x=t.x,this.m_pos.y=t.y,this.m_node?this.m_node.setPosition(this.m_pos):this.m_posChanged=!0},i.prototype.getPosition=function(){return this.m_node?this.m_node.getPosition():this.m_pos.clone()},i.prototype.setScale=function(t){this.m_scale.x=t.x,this.m_scale.y=t.y,this.m_node&&this.m_node.setScale(this.m_scale),this.m_scaleChanged=!0},i.prototype.getScale=function(){return this.m_scale},i.prototype.getAngle=function(){return this.m_node?this.m_node.angle:this.m_angle},i.prototype.setAngle=function(t){this.m_angle=t,this.m_node&&(this.m_node.angle=this.m_angle),this.m_angleChanged=!0},i.prototype.setWidth=function(t){this.m_width=t,this.m_node&&(this.m_node.width=this.m_width),this.m_widthChanged=!0},i.prototype.getWidth=function(){return this.m_node?this.m_node.width:this.m_width},i.prototype.setHeight=function(t){this.m_height=t,this.m_node&&(this.m_node.height=this.m_height),this.m_heightChanged=!0},i.prototype.getHeight=function(){return this.m_node?this.m_node.height:this.m_height},i.prototype.setAlpha=function(t){this.m_alpha=t,this.m_node&&(this.m_node.opacity=255*this.m_alpha),this.m_alphaChanged=!0},i.prototype.getAlpha=function(){return this.m_alpha},i.prototype.getColor=function(){return this.m_node?this.m_node.color:this.m_color},i.prototype.setColor=function(t,e){this.m_colorChanged=!0,this.m_color=t,this.m_colorIncludeChildren=e,this.onSetColor(this.m_node,this.m_color,this.m_colorIncludeChildren)},i.prototype.setNodeGroup=function(t){this.m_nodeGroup=t,this.m_node&&this.m_node.group!=t&&this.setNodeGroupWith(this.m_node,this.m_nodeGroup,!0),this.m_nodeGroupChanged=!0},i.prototype.getNodeGroup=function(){return this.m_nodeGroup},i.prototype.runAction=function(t){this.m_act!=t&&(this.m_act=t,this.m_node&&this.m_act&&this.m_node.runAction(this.m_act))},i.prototype.stopAllActions=function(){this.m_node&&this.m_node.stopAllActions(),this.m_act=null},i.prototype.pauseAllActions=function(){this.m_node&&this.m_node.pauseAllActions()},i.prototype.resumeAllActions=function(){this.m_node&&this.m_node.resumeAllActions()},i.prototype.show=function(){this.m_visibleState>0||(this.m_visibleState=1,this.m_node&&(this.m_node.active=!0),this.onShow())},i.prototype.hide=function(){this.m_visibleState<0||(this.m_visibleState=-1,this.m_node&&(this.m_node.active=!1),this.onHide())},i.prototype.setVisible=function(t){t?this.show():this.hide()},i.prototype.getVisible=function(){return this.m_node?this.m_node.active:this.m_visibleState>=0},i.prototype.clone=function(){var t=new i;return t.setResource(this.getResource()),t.bindNode(this.cloneNode()),t},i.prototype.cloneNode=function(){return this.m_node?t.Resource.duplicatePrefabInstance(this.m_node):this.getPrefabInstance()},i.prototype.getParent=function(){return this.m_parent},i.prototype.getNode=function(){return this.m_node},i.prototype.bindNode=function(t){this.m_node!=t&&(this.m_node&&this.onUnInitNode(this.m_node),this.m_node=t,this.onInitNode(this.m_node))},i.prototype.releaseNode=function(e,i){this.m_animation&&(this.m_animation.off(cc.Animation.EventType.FINISHED,this.onAnimationComplete,this),this.m_animation.stop()),this.m_animation=null,this.m_node&&(this.m_node.stopAllActions(),this.m_node.removeFromParent(!1),this.m_node.active=!1,i?this.m_node.destroy():e&&t.Resource.recyclePrefabInstance(this.m_node)),this.m_node=null},i.prototype.getComponent=function(t){return this.m_node?this.m_node.getComponent(t):null},i.prototype.getComponentInChildren=function(t){return this.m_node?this.m_node.getComponentInChildren(t):null},i.prototype.onShow=function(){},i.prototype.onHide=function(){},i.prototype.onInitPrefab=function(i){e.prototype.onInitPrefab.call(this,i),this.m_node&&this.onUnInitNode(this.m_node),this.m_node=t.Resource.requestPrefabInstance(i),this.onInitNode(this.m_node)},i.prototype.onUnInitPrefab=function(t){this.onUnInitNode(this.m_node),this.m_node=null,e.prototype.onUnInitPrefab.call(this,t)},i.prototype.onInitNode=function(t){t&&(this.m_parentChanged?this.m_parent?this.m_parent!=t.getParent()&&(t.removeFromParent(!1),this.m_parent.addChild(t)):t.removeFromParent(!1):this.m_parent=t.getParent(),0!=this.m_visibleState?t.active=this.m_visibleState>0:this.m_visibleState=t.active?1:-1,this.m_posChanged?t.setPosition(this.m_pos):t.getPosition(this.m_pos),this.m_scaleChanged?t.setScale(this.m_scale):t.getScale(this.m_scale),this.m_angleChanged?t.angle=this.m_angle:this.m_angle=t.angle,this.m_widthChanged?t.width=this.m_width:this.m_width=t.width,this.m_heightChanged?t.height=this.m_height:this.m_height=t.height,this.m_alphaChanged?t.opacity=255*this.m_alpha:this.m_alpha=t.opacity/255,this.m_colorChanged?this.onSetColor(t,this.m_color,this.m_colorIncludeChildren):this.m_color=t.color,this.m_nodeGroupChanged?this.setNodeGroupWith(this.m_node,this.m_nodeGroup,!0):this.m_nodeGroup=this.m_node.group,this.m_act&&t.runAction(this.m_act),this.onPlayAnimation(),this.m_resetParticleOnLoad&&this.onResetParticle())},i.prototype.onUnInitNode=function(e){e&&(this.m_animation&&(this.m_animation.off(cc.Animation.EventType.FINISHED,this.onAnimationComplete,this),this.m_animation.stop()),this.m_animation=null,e.stopAllActions(),e.removeFromParent(!1),e.active=!1,this.m_autoDestroyNode||this.isEmptyResource()?e.destroy():t.Resource.recyclePrefabInstance(e),e=null)},i.prototype.onSetColor=function(t,e,i){if(t&&(t.color=e,i)){var n=t.getComponentsInChildren(cc.Sprite);if(!n||n.length<=0)return;for(var o=n.length,s=0;s<o;s++)n[s].node.color=e}},i.prototype.setNodeGroupWith=function(t,e,i){if(void 0===i&&(i=!0),t&&(t.group=e,i))for(var n=t.childrenCount,o=0;o<n;o++)this.setNodeGroupWith(t.children[o],e,i)},i.prototype.dispose=function(){this.stopAllActions(),this.onDispose(),e.prototype.dispose.call(this),this.m_parent=null,this.m_act=null},i.prototype.onDispose=function(){this.m_animationName=""},i.prototype.playAnimation=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.m_animationName=t,this.m_animationCallback=e,this.m_animationCallbackTarget=i,this.isLoading()||this.onPlayAnimation()},i.prototype.stopAnimation=function(t){void 0===t&&(t=""),this.isLoading()?""!=t&&this.m_animationName!=t||(this.m_animationName=t,this.m_animationCallback=null,this.m_animationCallbackTarget=null):this.m_animation&&this.m_animation.stop(t)},i.prototype.onPlayAnimation=function(){""!=this.m_animationName&&(this.m_animation||(this.m_animation=this.getComponent(cc.Animation),this.m_animation||(this.m_animation=this.getComponentInChildren(cc.Animation))),this.m_animation?(this.m_animation.stop(),this.m_animationCallback&&this.m_animation.on(cc.Animation.EventType.FINISHED,this.onAnimationComplete,this),this.m_animation.play(this.m_animationName)):this.onAnimationComplete())},i.prototype.onAnimationComplete=function(){if(this.m_animation&&this.m_animation.off(cc.Animation.EventType.FINISHED,this.onAnimationComplete,this),this.m_animationCallback){var t=this.m_animationName,e=this.m_animationCallback,i=this.m_animationCallbackTarget;this.m_animationName="",this.m_animationCallback=null,this.m_animationCallbackTarget=null,e.call(i,t,this)}},i.prototype.resetParticle=function(){this.isLoading()?this.m_resetParticleOnLoad=!0:this.onResetParticle()},i.prototype.onResetParticle=function(){(this.m_particle||(this.m_particle=this.getComponent(cc.ParticleSystem),this.m_particle))&&this.m_particle.resetSystem()},i.prototype.stopParticle=function(){this.isLoading()||this.onStopParticle()},i.prototype.onStopParticle=function(){this.m_particle&&this.m_particle.stopSystem()},i}(t.LazyLoader);t.LazyNode=e}(miniframe||(miniframe={})),function(t){(function(t){t[t.NONE=0]="NONE",t[t.LOADING=1]="LOADING",t[t.COMPLETE=2]="COMPLETE",t[t.SAVED=3]="SAVED"})(t.LoadStateDefine||(t.LoadStateDefine={}))}(miniframe||(miniframe={})),function(t){t.SimpleLoadData=function(t,e){this.res=null,this.isConfig=!1,this.res=t,this.isConfig=e}}(miniframe||(miniframe={})),function(t){var e=function(){function e(t){void 0===t&&(t=""),this.m_name="",this.m_loadingPackageCounter=0,this.m_loadingPackageNames=[],this.m_loadingPackageIDs=[],this.m_loadingPackageProgresses=[],this.m_currentProgress=0,this.m_totalProgress=0,this.m_listener=null,this.m_name=t}return e.prototype.setName=function(t){this.m_name=t},e.prototype.load=function(t,e,i){this.m_listener=e,this.loadResource(t,i)||this.m_listener&&this.m_listener.onSimpleLoadComplete(this.m_name)},e.prototype.updateProgresses=function(){if(!(this.m_loadingPackageProgresses.length<=0)){for(var t=0,e=this.m_loadingPackageProgresses.length,i=0;i<e;i++)t+=this.m_loadingPackageProgresses[i];var n=(this.m_currentProgress+t)/this.m_totalProgress;this.m_listener&&this.m_listener.onSimpleLoadProgress(this.m_name,n)}},e.prototype.loadResource=function(e,i){this.m_currentProgress=0,this.m_totalProgress=0;for(var n=Math.min(i,e.length),o=0;o<n;o++)this.m_loadingPackageCounter++,this.m_loadingPackageNames.push(this.m_name+"_"+this.m_loadingPackageCounter),this.m_loadingPackageIDs.push(t.Loader.beginGroupLoad(this.m_name+"_"+this.m_loadingPackageCounter)),this.m_loadingPackageProgresses.push(0);var s="";for(n=e.length,o=0;o<n;o++){var r=o%i;s=e[o].res,e[o].isConfig&&(s=t.Config.getConfigNameByKey(e[o].res)),t.Loader.hasResource(s)||t.Loader.addGroupLoadResource(this.m_loadingPackageIDs[r],s)}for(this.m_totalProgress=this.m_loadingPackageIDs.length;this.m_loadingPackageIDs.length>0;)t.Loader.endGroupLoad(this.m_loadingPackageIDs.pop(),this)||(this.m_loadingPackageNames.splice(this.m_loadingPackageIDs.length,1),this.m_loadingPackageProgresses.splice(this.m_loadingPackageIDs.length,1),this.m_currentProgress++);return this.m_loadingPackageNames.length>0},e.prototype.onLoadAssetLoadProgress=function(t,e,i){var n=this.m_loadingPackageNames.indexOf(t);-1!=n&&(this.m_loadingPackageProgresses[n]=e/i,this.updateProgresses())},e.prototype.onLoadAssetLoadComplete=function(t){var e=this.m_loadingPackageNames.indexOf(t);-1!=e&&(this.m_loadingPackageNames.splice(e,1),this.m_loadingPackageProgresses.splice(e,1),this.m_currentProgress++,this.m_loadingPackageNames.length<=0&&this.m_listener&&this.m_listener.onSimpleLoadComplete(this.m_name))},e}();t.SimpleLoader=e}(miniframe||(miniframe={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.sendNotification=function(e,i){t.prototype.sendNotification.call(this,e,i,"")},e.prototype.execute=function(t){this.onExecute(t.getName(),t.getBody())},e.prototype.onExecute=function(){},e}(puremvc.SimpleCommand);t.AbstractCommand=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(){this.m_bytes=[],this.m_position=0}return e.prototype.getLength=function(){return this.m_bytes.length},e.prototype.getByte=function(t){return t<=0||t>=this.m_bytes.length?0:this.m_bytes[t]},e.prototype.writeInt32=function(t,e){var i=0,n=0,o=0,s=0;e?(i=t<<24>>24,n=t<<16>>24,o=t<<8>>24,s=t<<0>>24):(i=t<<0>>24,n=t<<8>>24,o=t<<16>>24,s=t<<24>>24),this.m_bytes.push(i),this.m_bytes.push(n),this.m_bytes.push(o),this.m_bytes.push(s)},e.prototype.writeUint32=function(t,e){t=t<<1>>1,this.writeInt32(t,e)},e.prototype.writeInt16=function(t,e){var i=0,n=0;e?(i=t<<24>>24,n=t<<16>>24):(i=t<<16>>24,n=t<<24>>24),this.m_bytes.push(i),this.m_bytes.push(n)},e.prototype.writeUint16=function(t,e){t=t<<1>>1,this.writeInt16(t,e)},e.prototype.writeStringBytes=function(t){for(var e=t.length,i=0;i<e;i++)this.m_bytes.push(t.charCodeAt(i))},e.prototype.writeBytes=function(t){for(var e=t.byteLength,i=0;i<e;i++)this.m_bytes.push(t[i])},e.prototype.readInt32=function(t){var e=0,i=0,n=0,o=0;return t?(e=this.readByte()<<0,i=this.readByte()<<8,n=this.readByte()<<16,o=this.readByte()<<24):(e=this.readByte()<<24,i=this.readByte()<<16,n=this.readByte()<<8,o=this.readByte()<<0),e+i+n+o},e.prototype.readUint32=function(t){var e=this.readInt32(t);return e<<1>>1},e.prototype.readInt16=function(){return(this.readByte()<<8)+(this.readByte()<<0)},e.prototype.readUint16=function(t){var e=this.readInt16(t);return e<<1>>1},e.prototype.readString=function(){for(var t=null,e="";0!=(t=this.readByte())&&t!="\\0".charCodeAt(0);)e+=String.fromCharCode(t);return e},e.prototype.readBytes=function(t){for(var e=new Uint8Array(t),i=0;i<t;i++)e[i]=this.readByte();return e},e.prototype.readByte=function(){if(this.m_position<0||this.m_position>=this.m_bytes.length)return 0;var t=this.m_bytes[this.m_position];return this.m_position++,t},e.prototype.toUint8Array=function(){return new Uint8Array(this.m_bytes)},e.prototype.toBlob=function(){return new Blob([this.toUint8Array().buffer])},e.prototype.fromArrayBuffer=function(t){this.m_bytes.length=t.byteLength;for(var e=t.byteLength,i=0;i<e;i++)this.m_bytes[i]=t[i]},e.prototype.fromUint8Array=function(t){this.m_bytes.length=t.byteLength;for(var e=t.byteLength,i=0;i<e;i++)this.m_bytes[i]=t[i]},e.prototype.fromAny=function(e){if("string"==typeof e){var i=t.strToBytes(e),n=i.length;this.m_bytes.length=n;for(var o=0;o<n;o++)this.m_bytes[o]=i[o]}else cc.sys.platform==cc.sys.DESKTOP_BROWSER&&e instanceof Uint8Array?this.fromUint8Array(e):this.fromUint8Array(new Uint8Array(e))},e}();t.ByteArray=e}(miniframe||(miniframe={})),function(t){t.NetworkClientData=function(){this.clientID=0,this.clientName="",this.reconnectDelta=0,this.retryCount=0,this.listener=null,this.isExt=!1,this.connectTimeout=0,this.version=0}}(miniframe||(miniframe={})),function(t){var e=function(){function e(e){void 0===e&&(e=256),this.m_url="",this.m_client=null,this.m_listener=null,this.m_serializer=null,this.m_sendQueue=null,this.m_sendMax=0,this.m_listening=!1,this.m_sendQueue=new t.Queue,this.m_sendMax=e}return e.prototype.setListener=function(t){this.m_listener=t},e.prototype.setMessageSerializer=function(t){this.m_serializer=t},e.prototype.connect=function(t){console.info("socket start connect"),this.m_url=t,this.m_client=null,this.createSocket(),this.listen()},e.prototype.createSocket=function(){var t=this;console.info("socket create begin"),this.m_client=new WebSocket(this.m_url),this.m_client.onopen=function(){console.info("socket open"),t.m_listener&&t.m_listener.onClientOpen()},this.m_client.onmessage=function(e){var i=e.data;if(i&&i.byteLength){var n=new Uint8Array(i),o=t.m_serializer.deserializeMessage(n);if(!o)return;t.m_listener.onReceiveMessage(o)}else{var s=e.data;if(s&&s.size){var r=new FileReader;return r.readAsArrayBuffer(s),void(r.onload=function(){var e=r.result,i=new Uint8Array(e),n=t.m_serializer.deserializeMessage(i);n&&t.m_listener.onReceiveMessage(n)})}}},this.m_client.onerror=function(e){console.info("socket error",e),t.m_listener&&t.m_listener.onClientError(e)},this.m_client.onclose=function(){console.info("socket close"),t.m_listener&&t.m_listener.onClientClose()},console.info("socket create end")},e.prototype.listen=function(){if(!this.m_listening){this.m_listening=!0;var t=this;setInterval(function(){if(t.m_client.readyState==WebSocket.OPEN&&!(t.m_client.bufferedAmount>0||t.m_sendQueue.getCount()<=0)){t.m_sendQueue.beginIterate();var e=t.m_sendQueue.shift(),i=t.m_serializer.serializeMessage(e);t.m_client.send(i.toUint8Array().buffer),t.m_sendQueue.endIterate()}},3)}},e.prototype.unlisten=function(){this.m_listening&&(this.m_listening=!1)},e.prototype.close=function(){this.m_client&&this.m_client.close()},e.prototype.getState=function(){return this.m_client?this.m_client.readyState:0},e.prototype.sendMessage=function(t){this.m_sendQueue.add(t)},e}();t.SocketClient=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(e,i,n,o,s){this.m_clientID=0,this.m_name="",this.m_reconnectDelta=0,this.m_retryCount=0,this.m_receiver=null,this.m_sessionIDCounter=0,this.m_sessionMap={},this.m_socketClient=null,this.m_url="",this.m_connecting=!1,this.m_reconnecting=!1,this.m_reconnectDelyCount=0,this.m_connected=!1,this.m_connectCount=0,this.m_errorCount=0,this.m_listening=!1,this.m_listener=null,this.m_clientID=e,this.m_name=i,this.m_reconnectDelta=n,this.m_retryCount=o,this.m_socketClient=new t.SocketClient,this.m_socketClient.setListener(this),this.m_socketClient.setMessageSerializer(s)}return e.prototype.setListener=function(t){this.m_listener=t},e.prototype.setSocketMessageReceiver=function(t){this.m_receiver=t},e.prototype.listen=function(){this.m_listening||(this.m_listening=!0,t.Timer.addUpdateEventListener(this))},e.prototype.unlisten=function(){this.m_listening&&(this.m_listening=!1,t.Timer.removeUpdateEventListener(this))},e.prototype.connect=function(t){this.m_connected?console.info(this.m_name+" is connected "+this.m_connected):this.m_connecting||this.m_reconnecting?console.info(this.m_name+" is connecting "+this.m_connecting+", "+this.m_reconnecting):(console.info("start connect "+this.m_name),this.m_connecting=!0,this.m_reconnecting=!1,this.m_errorCount=0,this.m_connectCount=0,this.m_url=t,this.m_socketClient.connect(t),this.listen())},e.prototype.reconnect=function(t,e,i){void 0===i&&(i=!1),this.m_connected?console.info(this.m_name+" is connected (re) "+this.m_connected):this.m_connecting||this.m_reconnecting?console.info(this.m_name+" is reconnecting (re) "+this.m_connecting+", "+this.m_reconnecting):(console.info("start reconnect (re) "+this.m_name+":"+e+":"+t),this.m_connecting=!1,this.m_reconnecting=!0,this.m_reconnectDelyCount=t,this.m_errorCount=0,e&&(this.m_connectCount=0),this.listen())},e.prototype.reconnectNow=function(t,e){void 0===e&&(e=!1),this.m_connected?console.info(this.m_name+" is connected (re now) "+this.m_connected):this.m_connecting?console.info(this.m_name+" is connecting (re now) "+this.m_connecting):(console.info("start reconnect (re now) "+this.m_name+":"+t+":"+this.m_reconnecting),this.m_reconnecting?this.m_reconnectDelyCount>0&&(this.m_reconnectDelyCount=0,this.tryReconnect(0)):this.reconnect(0,t))},e.prototype.close=function(t){void 0===t&&(t=!1),this.m_socketClient&&(this.m_socketClient.close(),t&&this.onClientClose())},e.prototype.sendMessage=function(t){var e=++this.m_sessionIDCounter;t.setSessionID(e),this.m_sessionMap[e]=t,this.m_socketClient.sendMessage(t)},e.prototype.onTimeSystemUpdate=function(t){return this.m_socketClient.getState()==WebSocket.OPEN?(this.m_connected=!0,this.m_errorCount=0,this.m_connectCount=0,this.m_connecting=!1,this.m_reconnecting?(this.m_reconnecting=!1,this.m_reconnectDelyCount=0,this.m_listener&&this.m_listener.onNetworkClientReconnectSuccess(this.m_clientID)):this.m_listener&&this.m_listener.onNetworkClientConnectSuccess(this.m_clientID),this.unlisten()):this.m_socketClient.getState()==WebSocket.CLOSED?this.m_reconnecting&&this.tryReconnect(t):this.m_socketClient.getState()==WebSocket.CLOSING&&this.m_reconnecting&&this.m_errorCount>0&&this.tryReconnect(t),!1},e.prototype.tryReconnect=function(t){this.m_reconnectDelyCount-=t,this.m_reconnectDelyCount<=0&&(this.m_connectCount++,this.connectSocket())},e.prototype.connectSocket=function(){this.m_reconnectDelyCount=0,this.m_socketClient.connect(this.m_url),console.info("reconnect socket "+this.m_name),this.m_listener&&this.m_listener.onNetworkClientReconnectStart(this.m_clientID)},e.prototype.onReceiveMessage=function(t){if(this.m_receiver){var e=this.m_sessionMap[t.getSessionID()];this.m_receiver.onReceiveMessage(t,e)}},e.prototype.onClientOpen=function(){},e.prototype.onClientError=function(){this.m_socketClient.getState()==WebSocket.CONNECTING?(console.info("close connecting "+this.m_name),this.m_socketClient.close(),this.m_errorCount++,this.onClientClose()):this.m_socketClient.getState()==WebSocket.CLOSED?(console.info("close closed "+this.m_name),this.onClientClose()):this.m_socketClient.getState()==WebSocket.OPEN?(console.info("close open "+this.m_name),this.close(!0)):this.m_socketClient.getState()==WebSocket.CLOSING?(console.info("close closing "+this.m_name),this.m_socketClient.close(),this.m_errorCount++,this.onClientClose()):console.info("socket error on state",this.m_socketClient.getState())},e.prototype.onClientClose=function(){if(this.m_connected=!1,this.m_connecting=!1,this.m_retryCount>0&&this.m_connectCount>=this.m_retryCount)return this.m_reconnecting=!1,void(this.m_listener&&this.m_listener.onNetworkClientReconnectFailed(this.m_clientID));this.m_reconnecting?(console.info("set reconnect delta "+this.m_name),this.m_reconnectDelyCount=this.m_reconnectDelta):this.m_listener&&this.m_listener.onNetworkClientDisconnect(this.m_clientID)},e.RECONNECT_DELTA=1e4,e}();t.NetworkClient=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(e,i,n,o,s,r){void 0===r&&(r=0),this.m_clientID=0,this.m_name="",this.m_reconnectDelta=0,this.m_retryCount=0,this.m_receiver=null,this.m_sessionIDCounter=0,this.m_sessionMap={},this.m_socketClient=null,this.m_url="",this.m_connecting=!1,this.m_reconnecting=!1,this.m_reconnectDelyCount=0,this.m_connected=!1,this.m_connectCount=0,this.m_connectTimeout=0,this.m_connectingTime=0,this.m_errorCount=0,this.m_listening=!1,this.m_listener=null,this.m_clientID=e,this.m_name=i,this.m_reconnectDelta=n,this.m_retryCount=o,this.m_connectTimeout=r,this.m_socketClient=new t.SocketClient,this.m_socketClient.setListener(this),this.m_socketClient.setMessageSerializer(s)}return e.prototype.setListener=function(t){this.m_listener=t},e.prototype.setSocketMessageReceiver=function(t){this.m_receiver=t},e.prototype.listen=function(){this.m_listening||(this.m_listening=!0,t.Timer.addUpdateEventListener(this))},e.prototype.unlisten=function(){this.m_listening&&(this.m_listening=!1,t.Timer.removeUpdateEventListener(this))},e.prototype.connect=function(t){this.m_connected?console.info(this.m_name+" is connected "+this.m_connected):this.m_connecting||this.m_reconnecting?console.info(this.m_name+" is connecting "+this.m_connecting+", "+this.m_reconnecting):(console.info("start connect "+this.m_name),this.m_connecting=!0,this.m_reconnecting=!1,this.m_errorCount=0,this.m_connectCount=0,this.m_connectingTime=0,this.m_url=t,this.m_socketClient.connect(t),this.listen())},e.prototype.reconnect=function(t,e,i){void 0===i&&(i=!1),this.m_connected?console.info(this.m_name+" is connected (re) "+this.m_connected):this.m_connecting||this.m_reconnecting?console.info(this.m_name+" is reconnecting (re) "+this.m_connecting+", "+this.m_reconnecting):(console.info("start reconnect (re) "+this.m_name+":"+e+":"+t),this.m_connecting=!1,this.m_reconnecting=!0,this.m_reconnectDelyCount=t,this.m_errorCount=0,this.m_connectingTime=0,e&&(this.m_connectCount=0),this.listen())},e.prototype.reconnectNow=function(t,e){void 0===e&&(e=!1),this.m_connected?console.info(this.m_name+" is connected (re now) "+this.m_connected):this.m_connecting?console.info(this.m_name+" is connecting (re now) "+this.m_connecting):(console.info("start reconnect (re now) "+this.m_name+":"+t+":"+this.m_reconnecting),this.m_reconnecting?this.m_reconnectDelyCount>0&&(this.m_reconnectDelyCount=0,this.tryReconnect(0)):this.reconnect(0,t))},e.prototype.close=function(t){void 0===t&&(t=!1),this.m_connectingTime=0,this.m_socketClient&&(this.m_socketClient.close(),t&&this.onClientClose())},e.prototype.sendMessage=function(t){var e=++this.m_sessionIDCounter;t.setSessionID(e),this.m_sessionMap[e]=t,this.m_socketClient.sendMessage(t)},e.prototype.onTimeSystemUpdate=function(t){return this.m_socketClient.getState()==WebSocket.CONNECTING?this.m_connectTimeout>0&&(this.m_connectingTime+=t,this.m_connectingTime>=this.m_connectTimeout&&this.close(!0)):this.m_socketClient.getState()==WebSocket.CLOSED?this.m_reconnecting&&this.tryReconnect(t):this.m_socketClient.getState()==WebSocket.CLOSING&&this.m_reconnecting&&this.m_errorCount>0&&this.tryReconnect(t),!1},e.prototype.tryReconnect=function(t){this.m_reconnectDelyCount-=t,this.m_reconnectDelyCount<=0&&(this.m_connectCount++,this.connectSocket())},e.prototype.connectSocket=function(){this.m_reconnectDelyCount=0,this.m_socketClient.connect(this.m_url),console.info("reconnect socket "+this.m_name),this.m_listener&&this.m_listener.onNetworkClientReconnectStart(this.m_clientID)},e.prototype.onReceiveMessage=function(t){if(this.m_receiver){var e=this.m_sessionMap[t.getSessionID()];this.m_receiver.onReceiveMessage(t,e)}},e.prototype.onClientOpen=function(){this.m_connected=!0,this.m_errorCount=0,this.m_connectCount=0,this.m_connecting=!1,this.m_connectingTime=0,this.m_reconnecting?(this.m_reconnecting=!1,this.m_reconnectDelyCount=0,this.m_listener&&this.m_listener.onNetworkClientReconnectSuccess(this.m_clientID)):this.m_listener&&this.m_listener.onNetworkClientConnectSuccess(this.m_clientID),this.unlisten()},e.prototype.onClientError=function(){this.m_socketClient.getState()==WebSocket.CONNECTING?(console.info("close connecting "+this.m_name),this.m_socketClient.close(),this.m_errorCount++,this.onClientClose()):this.m_socketClient.getState()==WebSocket.CLOSED?(console.info("close closed "+this.m_name),this.onClientClose()):this.m_socketClient.getState()==WebSocket.OPEN?(console.info("close open "+this.m_name),this.close(!0)):this.m_socketClient.getState()==WebSocket.CLOSING?(console.info("close closing "+this.m_name),this.m_socketClient.close(),this.m_errorCount++,this.onClientClose()):console.info("socket error on state",this.m_socketClient.getState())},e.prototype.onClientClose=function(){if(this.m_connected=!1,this.m_connecting=!1,this.m_connectingTime=0,this.m_retryCount>0&&this.m_connectCount>=this.m_retryCount)return this.m_reconnecting=!1,void(this.m_listener&&this.m_listener.onNetworkClientReconnectFailed(this.m_clientID));this.m_reconnecting?(console.info("set reconnect delta "+this.m_name),this.m_reconnectDelyCount=this.m_reconnectDelta):this.m_listener&&this.m_listener.onNetworkClientDisconnect(this.m_clientID)},e.RECONNECT_DELTA=1e4,e}();t.NetworkClientDx=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(){this.m_settings=null,this.m_clients={},this.m_receiver=null,e.ms_instance=this}return Object.defineProperty(e,"Instance",{get:function(){return e.ms_instance||new e},enumerable:!1,configurable:!0}),e.prototype.setup=function(t){this.m_settings=t,this.m_settings.initialize()},e.prototype.setSocketMessageReceiver=function(t){this.m_receiver=t},e.prototype.connect=function(e,i){var n=this.m_clients[e];if(!n){var o=this.m_settings.getSocketClientData(e);if(!o)return;var s=this.m_settings.getSocketMessageSerializer();o.version>1?(n=new t.SocketClientV2(e,o.clientName,o.reconnectDelta,o.retryCount,s,o.connectTimeout),console.info("create socket v2")):o.connectTimeout>0?(n=new t.NetworkClientDx(e,o.clientName,o.reconnectDelta,o.retryCount,s,o.connectTimeout),console.info("create socket dx")):(n=new t.NetworkClient(e,o.clientName,o.reconnectDelta,o.retryCount,s),console.info("create socket default")),n.setListener(o.listener),n.setSocketMessageReceiver(this.m_receiver),this.m_clients[e]=n}n.connect(i)},e.prototype.reconnect=function(t,e,i,n){void 0===n&&(n=!1);var o=this.m_clients[t];o&&o.reconnect(e,i,n)},e.prototype.reconnectNow=function(t,e,i){void 0===i&&(i=!1);var n=this.m_clients[t];n&&n.reconnectNow(e,i)},e.prototype.close=function(t,e){void 0===e&&(e=!1);var i=this.m_clients[t];i&&i.close(e)},e.prototype.sendMessage=function(t,e){var i=this.m_clients[t];i&&i.sendMessage(e)},e.ms_instance=null,e}();t.NetworkSystem=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(e,i,n,o,s,r,a){void 0===r&&(r=0),void 0===a&&(a=256),this.m_clientID=0,this.m_name="",this.m_url="",this.m_client=null,this.m_sendQueue=null,this.m_sendMax=0,this.m_serializer=null,this.m_receiver=null,this.m_listener=null,this.m_sessionIDCounter=0,this.m_sessionMap={},this.m_tickTimer=null,this.m_connectTimeout=null,this.m_reconnectTimeout=null,this.m_reconnectDelayTimer=null,this.m_reconnectCount=0,this.m_reconnectTotal=0,this.m_clientID=e,this.m_name=i,this.m_reconnectTotal=o,this.m_serializer=s,this.m_sendQueue=new t.Queue,this.m_sendMax=a,this.m_tickTimer=new t.SimpleTimer("tick").setDeltaMS(3).setTick(this.onTick,this).setLoop(0),this.m_connectTimeout=new t.SimpleTimer("conn_timeout").setDeltaMS(r||6e4).setTick(this.onConnectTimeout,this).setLoop(1),this.m_reconnectTimeout=new t.SimpleTimer("reconn_timeout").setDeltaMS(r||6e4).setTick(this.onReconnectTimeout,this).setLoop(1),this.m_reconnectDelayTimer=new t.SimpleTimer("reconn_delay").setDeltaMS(n).setTick(this.onReconnect,this).setLoop(1)}return e.prototype.setSocketMessageReceiver=function(t){this.m_receiver=t},e.prototype.setListener=function(t){this.m_listener=t},e.prototype.connect=function(t,e){if(void 0===e&&(e=!1),this.m_url==t&&!e){if(this.isConnected())return!1;if(this.isConnecting())return!1}return this.m_url=t,this.uninitWebSocket(),this.m_reconnectCount=0,this.m_reconnectTimeout.stop(),this.m_reconnectDelayTimer.stop(),this.m_connectTimeout.start(),this.initWebSocket(),!0},e.prototype.reconnect=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=!1),void 0===i&&(i=!1),!i){if(this.isConnected())return!1;if(this.isConnecting())return!1}return this.uninitWebSocket(),e&&(this.m_reconnectCount=0),this.m_reconnectCount++,this.m_connectTimeout.stop(),this.m_reconnectDelayTimer.stop(),this.m_reconnectTimeout.start(),this.initWebSocket(),!0},e.prototype.reconnectNow=function(t,e){return void 0===t&&(t=!1),void 0===e&&(e=!1),this.m_reconnectTimeout.isRunning()&&(console.info("socket reconnect close first"),this.close(!0)),this.reconnect(0,t,e)},e.prototype.isConnected=function(){return!!this.m_client&&this.m_client.readyState==WebSocket.OPEN},e.prototype.isConnecting=function(){return!!this.m_client&&this.m_client.readyState==WebSocket.CONNECTING},e.prototype.close=function(t){return void 0===t&&(t=!1),!!this.m_client&&(this.m_tickTimer.stop(),this.m_connectTimeout.stop(),this.m_reconnectTimeout.stop(),this.m_reconnectDelayTimer.stop(),this.uninitWebSocket(),t?(console.info("close web socket directly"),this.m_reconnectCount<=0&&this.m_listener&&this.m_listener.onNetworkClientDisconnect(this.m_clientID)):this.onWebSocketClose(null),!0)},e.prototype.onConnectTimeout=function(){this.close()},e.prototype.tryReconnect=function(){this.m_reconnectTotal>0&&this.m_reconnectCount>=this.m_reconnectTotal?this.m_listener&&this.m_listener.onNetworkClientReconnectFailed(this.m_clientID):(this.m_listener&&this.m_listener.onNetworkClientReconnectStart(this.m_clientID),this.m_reconnectDelayTimer.start())},e.prototype.onReconnect=function(){this.reconnectNow(!1,!0)},e.prototype.onReconnectTimeout=function(){this.close()},e.prototype.sendMessage=function(t){var e=++this.m_sessionIDCounter;t.setSessionID(e),this.m_sessionMap[e]=t,this.m_sendQueue.add(t)},e.prototype.initWebSocket=function(){var t=this;this.m_client=new WebSocket(this.m_url),this.m_client.onopen=function(e){t.onWebSocketOpen(e)},this.m_client.onmessage=function(e){t.onWebSocketMessage(e)},this.m_client.onerror=function(e){t.onWebSocketError(e)},this.m_client.onclose=function(e){t.onWebSocketClose(e)}},e.prototype.uninitWebSocket=function(){this.m_client&&(this.m_client.onopen=null,this.m_client.onmessage=null,this.m_client.onerror=null,this.m_client.onclose=null,this.m_client.readyState!=WebSocket.CLOSED&&this.m_client.close(),this.m_client=null)},e.prototype.onWebSocketOpen=function(t){console.info("web socket open",t),this.m_connectTimeout.stop(),this.m_reconnectTimeout.stop(),this.m_reconnectDelayTimer.stop(),this.m_tickTimer.start();var e=this.m_reconnectCount>0;this.m_reconnectCount=0,this.m_listener&&(e?this.m_listener.onNetworkClientReconnectSuccess(this.m_clientID):this.m_listener.onNetworkClientConnectSuccess(this.m_clientID))},e.prototype.onWebSocketMessage=function(t){var e=this,i=t.data;if(i&&i.byteLength){var n=new Uint8Array(i),o=this.m_serializer.deserializeMessage(n);if(!o)return;this.onReceiveMessage(o)}else{var s=t.data;if(s&&s.size){var r=new FileReader;return r.readAsArrayBuffer(s),void(r.onload=function(){var t=r.result,i=new Uint8Array(t),n=e.m_serializer.deserializeMessage(i);n&&e.onReceiveMessage(n)})}}},e.prototype.onWebSocketError=function(t){console.info("web socket error",t),this.close()},e.prototype.onWebSocketClose=function(t){t?console.info("web socket close",t):console.info("web socket close manually"),this.m_tickTimer.stop(),this.m_connectTimeout.stop(),this.m_reconnectTimeout.stop(),this.m_reconnectDelayTimer.stop(),this.m_reconnectCount<=0&&this.m_listener&&this.m_listener.onNetworkClientDisconnect(this.m_clientID),this.tryReconnect()},e.prototype.onReceiveMessage=function(t){if(this.m_receiver){var e=this.m_sessionMap[t.getSessionID()];this.m_receiver.onReceiveMessage(t,e)}},e.prototype.onTick=function(){if(this.m_client&&this.m_client.readyState==WebSocket.OPEN&&!(this.m_client.bufferedAmount>0||this.m_sendQueue.getCount()<=0)){this.m_sendQueue.beginIterate();var t=this.m_sendQueue.shift(),e=this.m_serializer.serializeMessage(t);this.m_client.send(e.toUint8Array().buffer),this.m_sendQueue.endIterate()}},e}();t.SocketClientV2=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(t){void 0===t&&(t=""),this.m_key="",this.m_uid=0,this.m_deltaMS=0,this.m_loopTotal=1,this.m_loopCount=0,this.m_tick=null,this.m_tickTarget=null,this.m_autoRecycle=!1,this.m_handle=NaN,this.m_key=t}return e.Request=function(){var t=null;t=e.ms_freeTimers.length>0?e.ms_freeTimers.pop():(new e).setAutoRecycle(!0),e.ms_timerUIDCounter++;var i=e.ms_timerUIDCounter;return t.setUID(i),e.ms_busyTimers[i]=t,t},e.Stop=function(t){e.ms_busyTimers[t]&&(e.ms_busyTimers[t].stop(),e.Recycle(e.ms_busyTimers[t]))},e.Recycle=function(i){var n=i.getUID();i.clear(),delete e.ms_busyTimers[n],t.safePush(e.ms_freeTimers,i)},e.prototype.setUID=function(t){return this.m_uid=t,this},e.prototype.getUID=function(){return this.m_uid},e.prototype.setDeltaMS=function(t){return this.m_deltaMS=t,this},e.prototype.setTick=function(t,e){return this.m_tick=t,this.m_tickTarget=e,this},e.prototype.setLoop=function(t){return this.m_loopTotal=t,this},e.prototype.setAutoRecycle=function(t){return this.m_autoRecycle=t,this},e.prototype.start=function(t){if(void 0===t&&(t=!0),!isNaN(this.m_handle)){if(!t)return this.getUID();this.removeEvent()}return this.m_loopCount=0,this.addEvent(),this.getUID()},e.prototype.stop=function(){var t=!isNaN(this.m_handle);this.removeEvent(),t&&this.m_autoRecycle&&this.recycle()},e.prototype.clear=function(){this.m_deltaMS=0,this.m_loopCount=0,this.m_loopTotal=0,this.m_tick=null,this.m_tickTarget=null,this.m_handle=NaN},e.prototype.recycle=function(){e.Recycle(this)},e.prototype.isRunning=function(){return!isNaN(this.m_handle)},e.prototype.addEvent=function(){var t=this;this.m_loopTotal>0?this.m_handle=setTimeout(function(){t.onTick()},this.m_deltaMS):this.m_handle=setInterval(function(){t.onTick()},this.m_deltaMS)},e.prototype.removeEvent=function(){isNaN(this.m_handle)||(this.m_loopTotal>0?clearTimeout(this.m_handle):clearInterval(this.m_handle),this.m_handle=NaN)},e.prototype.onTick=function(){this.m_loopTotal>0?(this.m_loopCount++,this.invoke(),this.m_loopCount<this.m_loopTotal?this.addEvent():this.onEnd()):this.invoke()},e.prototype.onEnd=function(){this.m_handle=NaN,this.m_autoRecycle&&this.recycle()},e.prototype.invoke=function(){this.m_tick&&this.m_tick.call(this.m_tickTarget,this)},e.ms_timerUIDCounter=0,e.ms_freeTimers=[],e.ms_busyTimers={},e}();t.SimpleTimer=e}(miniframe||(miniframe={})),function(t){var e=function(e){function i(t,i,n,o,s,r){var a=e.call(this,t)||this;return a.m_view=null,a.m_resource="",a.m_layer=0,a.m_autoDispose=!1,a.m_isConst=!1,a.m_showLoading=!1,a.m_initialized=!1,a.m_resource=i,a.m_layer=n,a.m_autoDispose=o,a.m_isConst=s,a.m_showLoading=r,a}return __extends(i,e),i.prototype.setResource=function(t){this.m_resource=t},i.prototype.setLayer=function(t){this.m_layer=t},i.prototype.setNeedDispose=function(t){this.m_autoDispose=t},i.prototype.setIsConst=function(t){this.m_isConst=t},i.prototype.getOpenAudio=function(){return""},i.prototype.getCloseAudio=function(){return""},i.prototype.onMediatorOpen=function(i){""!=this.m_resource?t.UI.show(this.m_resource,this.m_layer,this.m_isConst,this,this.m_showLoading):(this.m_initialized||(this.m_initialized=!0,this.onUIMediatorInit(null,i)),this.addEvents(),this.onUIMediatorOpen(null,i),this.onUIMediatorAfterOpen(),e.prototype.onMediatorOpen.call(this,i))},i.prototype.onMediatorClose=function(t){this.removeEvents(),this.onUIMediatorBeginClose(t),this.onPlayCloseAudio(),this.checkUIMediatorCanClose(t)||this.onUIMediatorCanClose()},i.prototype.onMediatorRefresh=function(t){e.prototype.onMediatorRefresh.call(this,t),this.m_initialized&&this.onUIMediatorRefresh(t)},i.prototype.onMediatorDispose=function(){e.prototype.onMediatorDispose.call(this),this.removeEvents(),""!=this.m_resource&&this.m_view&&t.UI.dispose(this.mediatorName),this.onUIMediatorUnInit(),this.m_view=null,this.m_initialized=!1},i.prototype.addEvents=function(){},i.prototype.removeEvents=function(){},i.prototype.onUIMediatorInit=function(){},i.prototype.onUIMediatorPrepare=function(){},i.prototype.checkUIMediatorCanOpen=function(){return!1},i.prototype.onUIMediatorCanOpen=function(){this.addEvents(),this.onUIMediatorOpen(this.m_view,this.viewComponent),this.onUIMediatorAfterOpen(),e.prototype.onMediatorOpen.call(this,this.viewComponent)},i.prototype.onUIMediatorOpen=function(){},i.prototype.onUIMediatorAfterOpen=function(){},i.prototype.onUIMediatorRefresh=function(){},i.prototype.onUIMediatorBeginClose=function(){},i.prototype.checkUIMediatorCanClose=function(){return!1},i.prototype.onUIMediatorCanClose=function(){""!=this.m_resource&&this.m_view?t.UI.hide(this.m_resource,this,this.m_autoDispose):(this.onUIMediatorClose(this.viewComponent),this.onUIMediatorAfterClose(),e.prototype.onMediatorClose.call(this,this.viewComponent))},i.prototype.onUIMediatorClose=function(){},i.prototype.onUIMediatorAfterClose=function(){},i.prototype.onUIMediatorUnInit=function(){},i.prototype.onPlayOpenAudio=function(){t.Audio.playAudio(this.getOpenAudio())},i.prototype.onPlayCloseAudio=function(){t.Audio.playAudio(this.getCloseAudio())},i.prototype.handleUIMediatorShowComplete=function(t){this.m_view=t,this.m_initialized||(this.m_initialized=!0,this.onUIMediatorInit(this.m_view,this.viewComponent)),this.checkOpenState()&&(this.onPlayOpenAudio(),this.onUIMediatorPrepare(this.m_view,this.viewComponent),this.checkUIMediatorCanOpen(this.viewComponent)||this.onUIMediatorCanOpen())},i.prototype.handleUIMediatorHideComplete=function(){this.onUIMediatorClose(this.viewComponent),this.onUIMediatorAfterClose(),this.m_autoDispose?(this.onUIMediatorUnInit(),this.m_view=null,this.m_initialized=!1):e.prototype.onMediatorClose.call(this,this.viewComponent)},i}(t.AbstractMediator);t.AbstractUIMediator=e}(miniframe||(miniframe={})),function(t){var e=function(){function e(t,e,i){void 0===t&&(t=""),void 0===e&&(e=""),void 0===i&&(i=!1),this.m_resource="",this.m_mediatorName="",this.m_autoDispose=!1,this.m_view=null,this.m_parent=null,this.m_pos=cc.Vec3.ZERO,this.m_isShown=!1,this.m_resource=t,this.m_mediatorName=e,this.m_autoDispose=i}return e.prototype.bindView=function(t){this.m_view=t,this.m_view&&(this.m_pos=this.m_view.position,this.m_parent=this.m_view.getParent(),this.onUIViewInit(this.m_view),this.onUIViewPrepare(),this.onUIViewShowComplete())},e.prototype.setResource=function(t){this.m_resource=t},e.prototype.setMediatorName=function(t){this.m_mediatorName=t},e.prototype.getMediatorName=function(){return this.m_mediatorName},e.prototype.setPosition=function(t){this.m_pos=t,this.m_view&&(this.m_view.position=this.m_pos)},e.prototype.setParent=function(t){this.m_parent=t,this.addViewToParent()},e.prototype.show=function(){this.m_isShown||(this.m_isShown=!0,this.m_view?(this.m_view.active=!0,this.onUIViewShowComplete()):this.m_resource&&""!=this.m_resource&&t.Loader.loadResource(this.m_resource,this))},e.prototype.hide=function(){this.m_isShown&&(this.m_isShown=!1,this.m_view&&(this.m_view.active=!1,this.onUIViewHideComplete()),this.m_autoDispose&&this.dispose())},e.prototype.dispose=function(){this.m_view&&(this.onUIViewUnInit(),this.m_resource&&""!=this.m_resource&&(t.Loader.unloadResource(this.m_resource),this.m_view.destroy()),this.m_view=null),this.m_parent=null},e.prototype.addViewToParent=function(){this.m_view&&this.m_view.getParent()!=this.m_parent&&(this.m_view.getParent()&&this.m_view.removeFromParent(!1),this.m_parent&&this.m_parent.addChild(this.m_view))},e.prototype.onUIViewInit=function(){},e.prototype.onUIViewUnInit=function(){},e.prototype.onUIViewPrepare=function(){},e.prototype.onUIViewShowComplete=function(){},e.prototype.onUIViewHideComplete=function(){},e.prototype.onLoadAssetLoadProgress=function(){},e.prototype.onLoadAssetLoadComplete=function(e){if(this.m_resource==e){var i=t.Resource.createPrefabInstance(this.m_resource);i?(this.m_view=i,this.m_view.position=this.m_pos,this.onUIViewInit(this.m_view),this.onUIViewPrepare(),this.addViewToParent(),this.onUIViewShowComplete()):console.warn("init ui prefab error "+this.m_resource)}},e}();t.AbstractUIView=e}(miniframe||(miniframe={})),function(t){t.safePush=function(t,e){return!!t&&-1==t.indexOf(e)&&(t.push(e),!0)},t.safePushList=function(e,i){for(var n=0,o=i.length,s=0;s<o;s++)t.safePush(e,i[s])&&n++;return n},t.safeRemove=function(t,e){if(!t||t.length<=0)return null;var i=t.indexOf(e);return-1==i?null:t.splice(i,1)[0]},t.safeRemoveList=function(e,i){for(var n=0,o=i.length,s=0;s<o;s++)t.safeRemove(e,i[s])&&n++;return n},t.safeInsert=function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];if(t&&i&&i.length>0)for(var o=i.length,s=0;s<o;s++)-1==t.indexOf(i[s])&&(e>=t.length?t.push(i[s]):t.splice(e,0,i[s]),e++)}}(miniframe||(miniframe={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null);for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];this.func=null,this.target=null,this.parameters=null,this.func=t,this.target=e,this.parameters=i}return t.prototype.set=function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];this.func=t,this.target=e,this.parameters=i},t.prototype.setParameters=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.parameters=t},t.prototype.invoke=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.func&&(!t||t.length<=0?t=this.parameters:this.parameters&&this.parameters.length>0&&(t=t.concat(this.parameters)),this.func.apply(this.target,t))},t.prototype.invokeOnce=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.func){var i=this.func,n=this.target;!t||t.length<=0?t=this.parameters:this.parameters&&this.parameters.length>0&&(t=t.concat(this.parameters)),this.clear(),i.apply(n,t)}},t.prototype.compare=function(t){return this.func==t.func&&this.target==t.target},t.prototype.clear=function(){this.func=null,this.target=null,this.parameters=null},t}();t.Callback=e}(miniframe||(miniframe={})),function(t){t.add=function(t,e){return t.clone().add(e)},t.sub=function(t,e){return t.clone().sub(e)},t.mul=function(t,e){return t.clone().mul(e)},t.multiply=function(t,e){return t.clone().multiply(e)},t.divide=function(t,e){return t.clone().divide(e)},t.lerp=function(t,e,i){return t.clone().lerp(e,i)},t.distance=function(t,e){return t.clone().sub(e).mag()},t.cross=function(t,e){var i=t.signAngle(e);return i=cc.misc.radiansToDegrees(i),i*=.5,0==Math.floor(i)?t:(i<0&&(i=360+i),i=cc.misc.degreesToRadians(i),t.rotate(i))},t.compareNumber=function(t,e){return t-e}}(miniframe||(miniframe={})),function(t){function e(t,e){t&&(e?t.setMaterial(0,cc.Material.getBuiltinMaterial("2d-gray-sprite")):t.setMaterial(0,cc.Material.getBuiltinMaterial("2d-sprite")))}t.createNode=function(t){void 0===t&&(t="");var e=new cc.Node(t||"NewNode");return e.setPosition(0,0),e.setScale(1,1),e},t.createWidget=function(t,e){void 0===t&&(t=""),void 0===e&&(e=cc.Widget.AlignMode.ON_WINDOW_RESIZE);var i=new cc.Node(t||"NewWidget"),n=i.addComponent(cc.Widget);return n.isAlignLeft=!0,n.isAlignRight=!0,n.isAlignTop=!0,n.isAlignBottom=!0,n.top=0,n.bottom=0,n.left=0,n.right=0,n.alignMode=e,i.setPosition(0,0),i.setScale(1,1),i},t.createMask=function(t,e){void 0===t&&(t=""),void 0===e&&(e=!1);var i=new cc.Node(t||"NewMask");return i.addComponent(cc.Mask).inverted=e,i.setPosition(0,0),i.setScale(1,1),i},t.createCamera=function(t){void 0===t&&(t="");var e=new cc.Node(t||"NewCamera");return e.addComponent(cc.Camera),e.setScale(1,1),e},t.findNodeIn=function(e,i,n){var o=e.getChildByName(i);if(o)return o;if(!n)return null;for(var s=e.childrenCount,r=0;r<s&&!(o=t.findNodeIn(e.children[r],i,n));r++);return o},t.findNodesIn=function(e,i,n){for(var o=null,s=null,r=e.childrenCount,a=0;a<r;a++)e.children[a].name==i&&(o||(o=[]),o.push(e)),n&&(s=t.findNodesIn(e.children[a],i,n))&&s.length>0&&(o=o?o.concat(s):s);return o},t.findComponents=function(t,e,i){var n=i?t.getComponentsInChildren(e):null,o=t.getComponents(e);return!o||o.length<=0?n:!n||n.length<=0?o:o.concat(n)},t.findComponentInChildren=function(t,e){return t.getComponentInChildren(e)},t.findComponentsInChildren=function(t,e){return t.getComponentsInChildren(e)},t.moveToTop=function(t){t&&t.getParent()&&(t.getParent().removeChild(t),t.getParent().addChild(t))},t.moveToBottom=function(t){t&&t.getParent()&&(t.getParent().removeChild(t),t.getParent().insertChild(t,0))},t.toWorldPosition=function(t,e,i,n){void 0===n&&(n=1);var o=i.convertToWorldSpaceAR(cc.Vec2.ZERO),s=e.getPosition();if(o.x-=s.x,o.y-=s.y,1!=n){var r=.5*t.width,a=.5*t.height,m=new cc.Vec2(o.x-r,o.y-a);m.x*=n,m.y*=n,o.x=r+m.x,o.y=a+m.y}return o},t.toLocalPosition=function(t,e,i,n,o){if(void 0===o&&(o=1),1!=o){var s=.5*t.width,r=.5*t.height,a=new cc.Vec2(n.x-s,n.y-r);a.x/=o,a.y/=o,n.x=a.x+s,n.y=a.y+r}var m=e.getPosition();return n.x+=m.x,n.y+=m.y,i.convertToNodeSpaceAR(n)},t.grayNode=function(t,i,n){if(void 0===n&&(n=!0),n){var o=t.getComponentsInChildren(cc.RenderComponent);if(o&&o.length>0)for(var s=o.length,r=0;r<s;r++)e(o[r],i)}else e(t.getComponent(cc.Sprite),i)},t.grayRenderer=e}(miniframe||(miniframe={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.reset=function(){this.x=0,this.y=0},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toVec2=function(){return new cc.Vec2(this.x,this.y)},t.prototype.copyFrom=function(t){this.x=t.x||0,this.y=t.y||0},t.prototype.set2=function(t,e){this.x=t,this.y=e},t.prototype.mul=function(e){return new t(this.x*e,this.y*e)},t.parseFrom=function(e){return e?new t(e.getKey(),e.getValue()):new t},t.parseListFrom=function(e){for(var i=[],n=e.length,o=0;o<n;o++){var s=t.parseFrom(e[o]);i.push(s)}return i},t}();t.Number2=e}(miniframe||(miniframe={})),function(t){var e=function(t){function e(e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0);var o=t.call(this,e,i)||this;return o.z=0,o.z=n,o}return __extends(e,t),e.prototype.reset=function(){t.prototype.reset.call(this),this.z=0},e.prototype.clone=function(){return new e(this.x,this.y,this.z)},e.prototype.toVec3=function(){return new cc.Vec3(this.x,this.y,this.z)},e.prototype.copyFrom=function(e){t.prototype.copyFrom.call(this,e),this.z=e.z||0},e.prototype.set3=function(e,i,n){t.prototype.set2.call(this,e,i),this.z=n},e.prototype.mul=function(t){return new e(this.x*t,this.y*t,this.z*t)},e.parseFrom=function(t){return t?new e(t.getKey(),t.getValue(),t.getParam()):new e},e.parseListFrom=function(t){for(var i=[],n=t.length,o=0;o<n;o++){var s=e.parseFrom(t[o]);i.push(s)}return i},e}(t.Number2);t.Number3=e}(miniframe||(miniframe={})),function(t){var e=function(t){function e(e,i,n,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=0);var s=t.call(this,e,i,n)||this;return s.w=0,s.w=o,s}return __extends(e,t),e.prototype.reset=function(){t.prototype.reset.call(this),this.w=0},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.toVec4=function(){return new cc.Vec4(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){t.prototype.copyFrom.call(this,e),this.w=e.w||0},e.prototype.set4=function(e,i,n,o){t.prototype.set3.call(this,e,i,n),this.w=o},e.prototype.mul=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.parseFrom=function(t){return t?new e(t.getKey(),t.getValue(),t.getParam(),t.getExtra()):new e},e.parseListFrom=function(t){for(var i=[],n=t.length,o=0;o<n;o++){var s=e.parseFrom(t[o]);i.push(s)}return i},e}(t.Number3);t.Number4=e}(miniframe||(miniframe={})),function(t){var e=function(t){function e(e,i,n,o,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0);var r=t.call(this,e,i,n,o)||this;return r.v=0,r.v=s,r}return __extends(e,t),e.prototype.reset=function(){t.prototype.reset.call(this),this.v=0},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w,this.v)},e.prototype.copyFrom=function(e){t.prototype.copyFrom.call(this,e),this.v=e.v||0},e.prototype.set5=function(e,i,n,o,s){t.prototype.set4.call(this,e,i,n,o),this.v=s},e.prototype.mul=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t,this.v*t)},e.parseFrom=function(t){return t?new e(t.getKey(),t.getValue(),t.getParam(),t.getExtra(),t.getExtra2()):new e},e.parseListFrom=function(t){for(var i=[],n=t.length,o=0;o<n;o++){var s=e.parseFrom(t[o]);i.push(s)}return i},e}(t.Number4);t.Number5=e}(miniframe||(miniframe={})),function(t){t.toNumber=function(t){if("number"==typeof t)return t;if("string"==typeof t){if(-1==t.indexOf(".")){var e=parseInt(t);return isNaN(e)?0:e}var i=parseFloat(t);return isNaN(i)?0:i}return 0}}(miniframe||(miniframe={})),function(t){var e=function(){function t(){this.m_seeds=null,this.m_seedIndex=0}return t.prototype.setSeeds=function(t){this.m_seeds=t,this.m_seedIndex=0},t.prototype.randomIn100=function(){return this.randomInt(0,100)},t.prototype.randomInt=function(t,e){if(t==e)return t;if(this.m_seeds&&this.m_seeds.length>0){(this.m_seedIndex<0||this.m_seedIndex>=this.m_seeds.length)&&(this.m_seedIndex=0);var i=this.m_seeds[this.m_seedIndex];return Math.floor(t+(e-t)*i*.01)}return Math.round(Math.random()*(e-t)+t)},t.prototype.randomIntWith=function(t){return t?this.randomInt(t.x,t.y):0},t.prototype.randomWithList=function(t,e){void 0===e&&(e=!1);var i=this.randomInt(0,t.length-1);i<0?i=0:i>=t.length&&(i=t.length-1);var n=t[i];return e&&t.splice(i,1),n},t.prototype.randomWithInt2List=function(t){if(t.length<=0)return 0;for(var e=0,i=t.length,n=0;n<i;n++)e+=t[n].y;var o=0,s=this.randomInt(0,e);for(n=0;n<i;n++)if((o+=t[n].y)>=s)return t[n].x;return t[t.length-1].x},t}();t.Random=e,t.random=new e}(miniframe||(miniframe={})),function(t){function e(t){return t.replace(/\\/g,"/")}t.strToIntArray=function(e,i,n){if(void 0===i&&(i=","),void 0===n&&(n=!0),"number"==typeof e)return[e];if("string"!=typeof e)return[];var o=[],s=e.split(i);if(s&&s.length>0)for(var r=s.length,a=0;a<r;a++)""!=s[a]?o.push(t.toNumber(s[a])):0==n&&o.push(0);return o},t.formatParamString=function(t,e){for(var i=e.length,n=0;n<i;n++)t=t.replace(new RegExp("\\{"+n+"\\}","g"),e[n]+"");return t},t.formatTimeString=function(e,i){if(t.containsTimeString(e,"D")){var n=Math.floor(i/864e5);e=t.replaceTimeString(e,"D",n),i-=864e5*n}if(t.containsTimeString(e,"H")){var o=Math.floor(i/36e5);e=t.replaceTimeString(e,"H",o),i-=36e5*o}if(t.containsTimeString(e,"M")){var s=Math.floor(i/6e4);e=t.replaceTimeString(e,"M",s),i-=6e4*s}if(t.containsTimeString(e,"S")){var r=Math.floor(i/1e3);e=t.replaceTimeString(e,"S",r),i-=1e3*r}return t.containsTimeString(e,"X")&&(e=t.replaceTimeString(e,"X",i)),e},t.replaceTimeString=function(t,e,i){var n=t.indexOf(e);if(-1==n)return t;var o=i.toString();return n<t.length-1&&t[n+1]==e?(o.length<2&&(o="0"+o),t.replace(e+e,o)):t.replace(e,o)},t.replaceTimeMSString=function(t,e,i){var n,o=t.indexOf(e);return-1==o?t:o<t.length-1&&t[o+1]==e&&t[o+2]==e?((n=i+"").length<3&&(n="0"+n),t.replace(e+e,n)):o<t.length-1&&t[o+1]==e?((n=(i=i/1e3*100)+"").length<2&&(n="0"+n),t.replace(e+e,n)):t.replace(e,i+"")},t.containsTimeString=function(t,e){return-1!=t.indexOf(e)},t.getFileName=function(t){if(!t||""==t)return t;var i=(t=e(t)).lastIndexOf("/");return-1!=i?t.substring(i+1):t},t.getFileNameWithoutExtension=function(t){if(!t||""==t)return t;var i=(t=e(t)).lastIndexOf("/");return-1!=i&&(t=t.substring(i+1)),-1!=(i=t.lastIndexOf("."))&&(t=t.substring(0,i)),t},t.getFileExtension=function(t){if(!t||""==t)return"";var i=t.lastIndexOf(".");return-1==i?"":(t=e(t)).lastIndexOf("/")>=i?"":t.substring(i+1)},t.combinePath=function(t,i){return t&&""!=t?i&&""!=i?(t=e(t),"/"==(i=e(i))[0]&&(i=i.substring(1)),t.lastIndexOf("/")==t.length-1?t+i:t+"/"+i):t:i},t.buildQueryURL=function(t,e){var i=t.lastIndexOf("?");for(var n in-1==i?t+="?":(i=t.lastIndexOf("&"))!=t.length-1&&(t+="&"),e)t+=n+"="+e[n]+"&";return t.substring(0,t.length-1)},t.filterPath=e,t.strToBytes=function(t){for(var e=t.length,i=[],n=0,o=0;o<e;o++)(n=t.charCodeAt(o))>=65536&&n<=1114111?(i.push(n>>18&7|240),i.push(n>>12&63|128),i.push(n>>6&63|128),i.push(63&n|128)):n>=2048&&n<=65535?(i.push(n>>12&15|224),i.push(n>>6&63|128),i.push(63&n|128)):n>=128&&n<=2047?(i.push(n>>6&31|192),i.push(63&n|128)):i.push(255&n);return i}}(miniframe||(miniframe={})),function(t){t.now=function(){return Math.round((new Date).getTime()/1e3)},t.nowMS=function(){return Math.round((new Date).getTime())},t.today=function(t){void 0===t&&(t=!0);var e=new Date,i=t?e.getUTCFullYear():e.getFullYear(),n=t?e.getUTCMonth():e.getMonth(),o=t?e.getUTCDate():e.getDate(),s=new Date(Date.UTC(i,n,o,0,0,0));return Math.round(s.getTime()/1e3)},t.monday=function(t){void 0===t&&(t=!0);var e=new Date,i=t?e.getUTCFullYear():e.getFullYear(),n=t?e.getUTCMonth():e.getMonth(),o=t?e.getUTCDate():e.getDate(),s=new Date(Date.UTC(i,n,o,0,0,0)),r=Math.round(s.getTime()/1e3),a=t?e.getUTCDay():e.getDay();return 0==a&&(a=7),r+86400*(1-a)}}(miniframe||(miniframe={})),function(t){var e=function(){this.key=0,this.weight=0,this.continueCount=0,this.continueMax=0},i=function(){function i(){this.m_defaultKey=0,this.m_randoms=[],this.m_currentTotal=0,this.m_currentRate=0,this.m_currentValue=0,this.m_currentRandoms=[],this.m_seedIndex=0,this.m_seeds=null}return i.prototype.setRandomSeeds=function(t){this.m_seeds=t},i.prototype.reset=function(){this.m_randoms.length>0&&this.m_randoms.splice(0,this.m_randoms.length)},i.prototype.setDefaultKey=function(t){this.m_defaultKey=t},i.prototype.addRandomWeight=function(t,i,n){var o=new e;o.key=t,o.weight=i,o.continueCount=0,o.continueMax=n,this.m_randoms.push(o)},i.prototype.removeRandomWeight=function(t){for(var e=this.m_randoms.length,i=0;i<e;i++)if(this.m_randoms[i].key==t){this.m_randoms.splice(i,1);break}},i.prototype.hasRandomWeight=function(){return this.m_randoms.length>0},i.prototype.random=function(){if(this.pickCurrentBricks(),this.m_currentRandoms.length<=0)return this.m_defaultKey;this.m_currentRate=this.randomRange(0,this.m_currentTotal),this.m_currentValue=0;for(var t=this.m_currentRandoms.length,e=0;e<t;e++)if(this.m_currentValue+=this.m_currentRandoms[e].weight,this.m_currentRate<this.m_currentValue)return this.m_currentRandoms[e].continueCount++,this.m_currentRandoms[e].key;return this.m_currentRandoms[t-1].key},i.prototype.clone=function(){var t=new i;t.setDefaultKey(this.m_defaultKey),t.setRandomSeeds(this.m_seeds);for(var e=this.m_randoms.length,n=0;n<e;n++)t.addRandomWeight(this.m_randoms[n].key,this.m_randoms[n].weight,this.m_randoms[n].continueMax);return t},i.prototype.pickCurrentBricks=function(){this.m_currentTotal=0,this.m_currentRandoms=[];for(var t=this.m_randoms.length,e=0;e<t;e++)this.m_randoms[e].continueMax&&this.m_randoms[e].continueCount>=this.m_randoms[e].continueMax?this.m_randoms[e].continueCount=0:(this.m_currentTotal+=this.m_randoms[e].weight,this.m_currentRandoms.push(this.m_randoms[e]))},i.prototype.randomRange=function(e,i){return this.m_seeds&&this.m_seeds.length>0?this.randomRangeBySeed(e,i):t.random.randomInt(e,i)},i.prototype.randomRangeBySeed=function(t,e){return t+.01*(e-t)*this.getSeed()},i.prototype.getSeed=function(){return this.m_seedIndex>=this.m_seeds.length&&(this.m_seedIndex=0),this.m_seeds[this.m_seedIndex]},i}();t.WeightRandom=i}(miniframe||(miniframe={})),window.miniframe=miniframe;